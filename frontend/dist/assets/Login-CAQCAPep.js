import{o as U,c as f,a as _,b as r,w as l,t as I,d as S,r as x,e as u,f as b,u as R,g as v,h as i}from"./index-C2Rltc0A.js";import{a as c}from"./index-CzZzTWyT.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"login-container"},C={class:"login-form"},q={key:0,class:"error-message"},A={__name:"Login",setup(B){const m=R(),d=b(null),s=b(""),o=x({username:"",password:"",remember:!1}),w={username:[{required:!0,message:"请输入学号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},y=async()=>{if(d.value){console.log("开始登录处理..."),console.log("登录表单数据:",o);try{const a=await d.value.validate();if(console.log("表单验证结果:",a),a){console.log("表单验证通过，准备发送登录请求..."),console.log("登录请求参数:",{studentId:o.username,password:o.password});try{console.log("发送登录请求到 /user/login"),console.log("API实例:",c),console.log("API基础URL:",c.defaults.baseURL);const e=await c.post("/user/login",{studentId:o.username,password:o.password});console.log("登录请求成功，响应数据:",e),e.code===200?(console.log("Login response data:",e.data),console.log("User object:",e.data.user),console.log("User role:",e.data.user.role),localStorage.setItem("token",e.data.token),localStorage.setItem("user",JSON.stringify(e.data.user)),console.log("Stored user in localStorage:",JSON.stringify(e.data.user)),o.remember?localStorage.setItem("rememberedUsername",o.username):localStorage.removeItem("rememberedUsername"),s.value="",e.data.user.role===1?(console.log("Admin user, redirecting to /admin"),m.push("/admin")):(console.log("Regular user, redirecting to /home"),m.push("/home"))):(console.log("登录失败，响应消息:",e.message),e.message&&e.message.includes("系统正在更新中")?(console.log("系统正在更新中，显示更新提示..."),s.value="登录请求失败，请稍后重试"):s.value=e.message||"登录失败")}catch(e){console.error("登录请求失败:",e),console.error("错误信息:",e.message),console.error("错误堆栈:",e.stack),e.response?(console.error("错误响应数据:",e.response.data),console.error("错误响应状态:",e.response.status),console.error("错误响应头:",e.response.headers),e.response.data&&e.response.data.message?e.response.data.message.includes("系统正在更新中")?(console.log("系统正在更新中，显示更新提示..."),s.value="登录请求失败，请稍后重试"):s.value=e.response.data.message:s.value="登录请求失败，请稍后重试"):(e.request&&console.error("错误请求:",e.request),s.value="登录请求失败，请稍后重试")}}else console.log("表单验证失败")}catch(a){console.error("表单验证失败:",a),s.value="表单验证失败，请检查输入"}console.log("登录处理完成")}},V=()=>{m.push("/register")};return U(()=>{const a=localStorage.getItem("rememberedUsername");a&&(o.username=a,o.remember=!0)}),(a,e)=>{const g=u("el-input"),t=u("el-form-item"),h=u("el-checkbox"),p=u("el-button"),k=u("el-form");return v(),f("div",N,[_("div",C,[e[6]||(e[6]=_("h2",null,"河南农业大学期末资料共享平台",-1)),r(k,{model:o,rules:w,ref_key:"loginFormRef",ref:d,"label-width":"80px"},{default:l(()=>[r(t,{label:"用户名",prop:"username"},{default:l(()=>[r(g,{modelValue:o.username,"onUpdate:modelValue":e[0]||(e[0]=n=>o.username=n),placeholder:"请输入学号"},null,8,["modelValue"])]),_:1}),r(t,{label:"密码",prop:"password"},{default:l(()=>[r(g,{modelValue:o.password,"onUpdate:modelValue":e[1]||(e[1]=n=>o.password=n),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),r(t,null,{default:l(()=>[r(h,{modelValue:o.remember,"onUpdate:modelValue":e[2]||(e[2]=n=>o.remember=n),style:{"margin-right":"20px"}},{default:l(()=>[...e[3]||(e[3]=[i("记住账号",-1)])]),_:1},8,["modelValue"])]),_:1}),r(t,null,{default:l(()=>[r(p,{type:"primary",onClick:y,style:{width:"100%"}},{default:l(()=>[...e[4]||(e[4]=[i("登录",-1)])]),_:1})]),_:1}),r(t,null,{default:l(()=>[r(p,{type:"info",onClick:V,style:{width:"100%"}},{default:l(()=>[...e[5]||(e[5]=[i("注册",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),s.value?(v(),f("div",q,I(s.value),1)):S("",!0)])])}}},O=L(A,[["__scopeId","data-v-ecfc4d1b"]]);export{O as default};
