import{u as $,e as c,g as m,c as y,b as e,w as s,v as C,l as I,V as O,d as R,h as z,N as Q,z as W,f as v,E as x,J as X,o as Y,a as r,t as g,F as Z,A as ee,k as ae}from"./index-2wzUmdul.js";import{s as N}from"./index-CJj_0Lla.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"search-input-container"},le={__name:"SearchInput",setup(L){const b=$(),i=v(""),_=async(d,a)=>{if(!d){a([]);return}try{const u=await N.getKeywordSuggestions(d);if(u.code===200){const f=u.data.map(p=>({value:p}));a(f)}else a([])}catch(u){console.error("获取关键词联想失败:",u),a([])}},w=d=>{i.value=d,h()},h=async()=>{if(!i.value.trim()){x.warning("请输入搜索关键词");return}try{await N.recordSearchLog(i.value),b.push({path:"/search",query:{keyword:i.value}})}catch(d){console.error("搜索失败:",d),b.push({path:"/search",query:{keyword:i.value}})}},T=()=>{i.value=""};return(d,a)=>{const u=c("el-icon"),f=c("el-button"),p=c("el-autocomplete");return m(),y("div",te,[e(p,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=k=>i.value=k),"fetch-suggestions":_,"trigger-on-focus":!1,debounce:300,placeholder:"输入关键词搜索",class:"search-input",onSelect:w,onKeyup:W(h,["enter"])},{prefix:s(()=>[e(u,{class:"el-input__icon"},{default:s(()=>[e(I(Q))]),_:1})]),suffix:s(()=>[i.value?(m(),C(u,{key:0,class:"el-input__icon clear-icon",onClick:T},{default:s(()=>[e(I(O))]),_:1})):R("",!0),e(f,{type:"primary",size:"small",class:"search-btn",onClick:h},{default:s(()=>[...a[1]||(a[1]=[z(" 搜索 ",-1)])]),_:1})]),_:1},8,["modelValue"])])}}},oe=B(le,[["__scopeId","data-v-6e7e74d8"]]),se={class:"search-result-page"},ne={class:"search-header"},re={class:"search-input-wrapper"},ue={key:0,class:"search-info"},ce={class:"search-content"},ie={class:"filter-section"},de={class:"filter-form"},pe={class:"result-section"},_e={key:1,class:"result-list"},ve={class:"result-item-header"},me={class:"result-title"},fe={class:"result-integral"},ge={class:"result-item-body"},he={class:"result-description"},ye={class:"result-meta"},be={class:"result-author"},we={class:"result-time"},Te={class:"result-type"},Ve={class:"result-downloads"},ke={key:2,class:"pagination"},Se={__name:"SearchResult",setup(L){const b=ae(),i=$(),_=v(""),w=v([]),h=v(0),T=v(!1),d=v(["1"]),a=v({uploadTime:"",fileType:"",integralRange:""}),u=v(1),f=v(20);X(()=>b.query.keyword,t=>{t&&(_.value=t,U(),p())},{immediate:!0});const p=async()=>{if(_.value){T.value=!0;try{const t=new URLSearchParams;t.append("keyword",_.value),t.append("page",u.value),t.append("size",f.value),a.value.uploadTime&&t.append("uploadTime",a.value.uploadTime),a.value.fileType&&t.append("fileType",a.value.fileType),a.value.integralRange&&t.append("integralRange",a.value.integralRange);const n=await(await fetch(`/api/material/search?${t.toString()}`)).json();n.code===200?(w.value=n.data.records,h.value=n.data.total):x.error("获取搜索结果失败")}catch(t){console.error("获取搜索结果失败:",t),x.error("获取搜索结果失败")}finally{T.value=!1}}},k=()=>{u.value=1,p()},U=()=>{a.value={uploadTime:"",fileType:"",integralRange:""},u.value=1,p()},M=t=>{f.value=t,p()},P=t=>{u.value=t,p()},q=t=>{i.push(`/material/detail/${t}`)},D=t=>new Date(t).toLocaleString(),E=t=>({document:"文档",image:"图片",video:"视频",audio:"音频"})[t]||"其他";return Y(()=>{_.value=b.query.keyword||"",_.value&&p()}),(t,o)=>{const n=c("el-option"),S=c("el-select"),V=c("el-form-item"),F=c("el-button"),K=c("el-form"),j=c("el-collapse-item"),A=c("el-collapse"),J=c("el-empty"),G=c("el-card"),H=c("el-pagination");return m(),y("div",se,[r("div",ne,[r("div",re,[e(oe)]),_.value?(m(),y("div",ue,' 搜索 "'+g(_.value)+'" 的结果 ',1)):R("",!0)]),r("div",ce,[r("div",ie,[e(A,{modelValue:d.value,"onUpdate:modelValue":o[3]||(o[3]=l=>d.value=l)},{default:s(()=>[e(j,{title:"筛选条件",name:"1"},{default:s(()=>[r("div",de,[e(K,{inline:!0,model:a.value,class:"filter-form"},{default:s(()=>[e(V,{label:"上传时间"},{default:s(()=>[e(S,{modelValue:a.value.uploadTime,"onUpdate:modelValue":o[0]||(o[0]=l=>a.value.uploadTime=l),placeholder:"选择时间范围"},{default:s(()=>[e(n,{label:"今天",value:"today"}),e(n,{label:"近7天",value:"7days"}),e(n,{label:"近30天",value:"30days"}),e(n,{label:"本学期",value:"semester"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"文件类型"},{default:s(()=>[e(S,{modelValue:a.value.fileType,"onUpdate:modelValue":o[1]||(o[1]=l=>a.value.fileType=l),placeholder:"选择文件类型"},{default:s(()=>[e(n,{label:"文档",value:"document"}),e(n,{label:"图片",value:"image"}),e(n,{label:"视频",value:"video"}),e(n,{label:"音频",value:"audio"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"积分范围"},{default:s(()=>[e(S,{modelValue:a.value.integralRange,"onUpdate:modelValue":o[2]||(o[2]=l=>a.value.integralRange=l),placeholder:"选择积分范围"},{default:s(()=>[e(n,{label:"免费",value:"free"}),e(n,{label:"0-10分",value:"0-10"}),e(n,{label:"10-20分",value:"10-20"}),e(n,{label:"20分以上",value:"20+"})]),_:1},8,["modelValue"])]),_:1}),e(V,null,{default:s(()=>[e(F,{type:"primary",onClick:k},{default:s(()=>[...o[6]||(o[6]=[z("应用筛选",-1)])]),_:1}),e(F,{onClick:U},{default:s(()=>[...o[7]||(o[7]=[z("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1},8,["modelValue"])]),r("div",pe,[T.value||w.value.length===0?(m(),C(J,{key:0,description:"暂无搜索结果"})):(m(),y("div",_e,[(m(!0),y(Z,null,ee(w.value,l=>(m(),C(G,{key:l.id,class:"result-item",onClick:Ce=>q(l.id)},{default:s(()=>[r("div",ve,[r("h4",me,g(l.title),1),r("span",fe,g(l.integral)+"分",1)]),r("div",ge,[r("p",he,g(l.description),1),r("div",ye,[r("span",be,g(l.author),1),r("span",we,g(D(l.uploadTime)),1),r("span",Te,g(E(l.fileType)),1),r("span",Ve,g(l.downloadCount)+"次下载",1)])])]),_:2},1032,["onClick"]))),128))])),h.value>0?(m(),y("div",ke,[e(H,{"current-page":u.value,"onUpdate:currentPage":o[4]||(o[4]=l=>u.value=l),"page-size":f.value,"onUpdate:pageSize":o[5]||(o[5]=l=>f.value=l),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:h.value,onSizeChange:M,onCurrentChange:P},null,8,["current-page","page-size","total"])])):R("",!0)])])])}}},Ue=B(Se,[["__scopeId","data-v-14fe3097"]]);export{Ue as default};
