import{a as T}from"./index-CJj_0Lla.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{o as P,c as L,b as l,w as s,f as m,e as d,g as R,a as i,v as j,d as M,B as z,t as E,h as Y}from"./index-2wzUmdul.js";const F={class:"integral-rank"},q={class:"card-header"},A={class:"date-selector"},G={class:"rank-content"},H={class:"filter-container"},J={class:"rank-list"},K={__name:"IntegralRank",setup(O){const p=m("all"),h=m(""),k=m(""),_=m("today"),D=m(""),V=m([]),$=()=>{const t=new Date,a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return{year:a,month:n,day:r}},S=()=>{const{year:t,month:a,day:n}=$(),r=`${t}-${a}-${n} 00:00:00`,c=`${t}-${a}-${n} 23:59:59`;return{startDate:r,endDate:c}},x=t=>{let a,n;if(t)[a,n]=t.split("-");else{const b=$();a=b.year,n=b.month}const r=`${a}-${n}-01 00:00:00`,c=new Date(parseInt(a),parseInt(n),0).getDate(),e=`${a}-${n}-${c} 23:59:59`;return{startDate:r,endDate:e}},I=t=>{_.value=t,t==="today"?f("today"):t==="month"&&f("month")},B=t=>{t&&(_.value="month",f("month",t))},f=async(t,a=null)=>{try{let n=null,r=null;p.value==="college"&&h.value?n=h.value:p.value==="major"&&k.value&&(r=k.value);let c,e;if(t==="today"){const v=S();c=v.startDate,e=v.endDate}else if(t==="month"){const v=x(a||D.value);c=v.startDate,e=v.endDate}const b=await T.get("/integral/rank/date",{params:{limit:100,college:n,major:r,startDate:c,endDate:e}});if(b.code===200){console.log("后端返回的用户数量:",b.data.length);const v=b.data.map(o=>{const g=o.studentId||o.student_id||"",y=String(g),u=y.length>=2?y.slice(-2):y;return{userId:o.userId||o.user_id,nickname:`用户${u}`,college:o.college||"",major:o.major||"",totalPoints:o.totalPoints||o.total_points||0,uploadCount:o.uploadCount||o.upload_count||0}});console.log("处理后的用户数量:",v.length);const C=v.slice(0,100);console.log("最终显示的用户数量:",C.length),V.value=C.map((o,g)=>({...o,rank:g+1}))}}catch(n){console.error("加载排行榜数据失败:",n),V.value=[]}},w=async()=>{f(_.value)},N=t=>t<=3?"rank-top3":t<=10?"rank-top10":"";return P(()=>{const t=$();D.value=`${t.year}-${t.month}`,f("today")}),(t,a)=>{const n=d("el-button"),r=d("el-button-group"),c=d("el-date-picker"),e=d("el-option"),b=d("el-select"),v=d("el-form-item"),C=d("el-form"),o=d("el-table-column"),g=d("el-table"),y=d("el-card");return R(),L("div",F,[l(y,{class:"rank-card"},{header:s(()=>[i("div",q,[a[8]||(a[8]=i("span",null,"积分排行榜",-1)),i("div",A,[l(r,null,{default:s(()=>[l(n,{type:_.value==="today"?"primary":"default",onClick:a[0]||(a[0]=u=>I("today"))},{default:s(()=>[...a[6]||(a[6]=[Y("当天",-1)])]),_:1},8,["type"]),l(n,{type:_.value==="month"?"primary":"default",onClick:a[1]||(a[1]=u=>I("month"))},{default:s(()=>[...a[7]||(a[7]=[Y("本月",-1)])]),_:1},8,["type"])]),_:1}),l(c,{modelValue:D.value,"onUpdate:modelValue":a[2]||(a[2]=u=>D.value=u),type:"month",format:"YYYY年MM月","value-format":"YYYY-MM",placeholder:"选择月份",onChange:B,style:{"margin-left":"10px"}},null,8,["modelValue"])])])]),default:s(()=>[i("div",G,[i("div",H,[l(C,{inline:!0,class:"filter-form"},{default:s(()=>[l(v,{label:"筛选范围"},{default:s(()=>[l(b,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=u=>p.value=u),onChange:w},{default:s(()=>[l(e,{label:"全校",value:"all"}),l(e,{label:"学院",value:"college"}),l(e,{label:"专业",value:"major"})]),_:1},8,["modelValue"])]),_:1}),p.value==="college"?(R(),j(v,{key:0,label:"学院"},{default:s(()=>[l(b,{modelValue:h.value,"onUpdate:modelValue":a[4]||(a[4]=u=>h.value=u),onChange:w},{default:s(()=>[l(e,{label:"农学院",value:"农学院"}),l(e,{label:"林学院",value:"林学院"}),l(e,{label:"风景园林学院",value:"风景园林学院"}),l(e,{label:"艺术与设计学院",value:"艺术与设计学院"}),l(e,{label:"动物医学院",value:"动物医学院"}),l(e,{label:"动物科技学院",value:"动物科技学院"}),l(e,{label:"机电工程学院",value:"机电工程学院"}),l(e,{label:"经济与管理学院",value:"经济与管理学院"}),l(e,{label:"烟草学院",value:"烟草学院"}),l(e,{label:"植物保护学院",value:"植物保护学院"}),l(e,{label:"园艺学院",value:"园艺学院"}),l(e,{label:"信息与管理科学学院",value:"信息与管理科学学院"}),l(e,{label:"软件学院",value:"软件学院"}),l(e,{label:"生命科学学院",value:"生命科学学院"}),l(e,{label:"食品科学技术学院",value:"食品科学技术学院"}),l(e,{label:"资源与环境学院",value:"资源与环境学院"}),l(e,{label:"文法学院",value:"文法学院"}),l(e,{label:"马克思主义学院",value:"马克思主义学院"}),l(e,{label:"理学院",value:"理学院"}),l(e,{label:"外国语学院",value:"外国语学院"}),l(e,{label:"体育学院",value:"体育学院"}),l(e,{label:"国际教育学院",value:"国际教育学院"})]),_:1},8,["modelValue"])]),_:1})):M("",!0),p.value==="major"?(R(),j(v,{key:1,label:"专业"},{default:s(()=>[l(b,{modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=u=>k.value=u),onChange:w},{default:s(()=>[l(e,{label:"生物育种科学",value:"生物育种科学"}),l(e,{label:"动物医学",value:"动物医学"}),l(e,{label:"植物保护",value:"植物保护"}),l(e,{label:"人工智能",value:"人工智能"}),l(e,{label:"生物技术",value:"生物技术"}),l(e,{label:"农学",value:"农学"}),l(e,{label:"种子科学与工程",value:"种子科学与工程"}),l(e,{label:"智慧农业",value:"智慧农业"}),l(e,{label:"中药学",value:"中药学"}),l(e,{label:"林学",value:"林学"}),l(e,{label:"经济林",value:"经济林"}),l(e,{label:"生态学",value:"生态学"}),l(e,{label:"旅游管理",value:"旅游管理"}),l(e,{label:"智慧林业",value:"智慧林业"}),l(e,{label:"环境工程",value:"环境工程"}),l(e,{label:"园林",value:"园林"}),l(e,{label:"城乡规划",value:"城乡规划"}),l(e,{label:"风景园林",value:"风景园林"}),l(e,{label:"环境设计",value:"环境设计"}),l(e,{label:"产品设计",value:"产品设计"}),l(e,{label:"舞蹈表演",value:"舞蹈表演"}),l(e,{label:"兽医公共卫生",value:"兽医公共卫生"}),l(e,{label:"中兽医学",value:"中兽医学"}),l(e,{label:"药物制剂",value:"药物制剂"}),l(e,{label:"动物药学",value:"动物药学"}),l(e,{label:"动植物检疫",value:"动植物检疫"}),l(e,{label:"动物科学",value:"动物科学"}),l(e,{label:"智慧牧业科学与工程",value:"智慧牧业科学与工程"}),l(e,{label:"水产养殖学",value:"水产养殖学"}),l(e,{label:"饲料工程",value:"饲料工程"}),l(e,{label:"机械设计制造及其自动化",value:"机械设计制造及其自动化"}),l(e,{label:"能源与动力工程",value:"能源与动力工程"}),l(e,{label:"交通运输",value:"交通运输"}),l(e,{label:"汽车服务工程",value:"汽车服务工程"}),l(e,{label:"农业机械化及其自动化",value:"农业机械化及其自动化"}),l(e,{label:"农业建筑环境与能源工程",value:"农业建筑环境与能源工程"}),l(e,{label:"农业智能装备工程",value:"农业智能装备工程"}),l(e,{label:"电子信息工程",value:"电子信息工程"}),l(e,{label:"经济学",value:"经济学"}),l(e,{label:"经济与金融",value:"经济与金融"}),l(e,{label:"数字经济",value:"数字经济"}),l(e,{label:"农林经济管理",value:"农林经济管理"}),l(e,{label:"工商管理",value:"工商管理"}),l(e,{label:"财务管理",value:"财务管理"}),l(e,{label:"食品科学与工程",value:"食品科学与工程"}),l(e,{label:"香料香精技术与工程",value:"香料香精技术与工程"}),l(e,{label:"烟草",value:"烟草"}),l(e,{label:"制药工程",value:"制药工程"}),l(e,{label:"园艺",value:"园艺"}),l(e,{label:"设施农业科学与工程",value:"设施农业科学与工程"}),l(e,{label:"茶学",value:"茶学"}),l(e,{label:"信息与计算科学",value:"信息与计算科学"}),l(e,{label:"管理科学",value:"管理科学"}),l(e,{label:"计算机科学与技术",value:"计算机科学与技术"}),l(e,{label:"生物工程",value:"生物工程"}),l(e,{label:"生物科学",value:"生物科学"}),l(e,{label:"食品质量与安全",value:"食品质量与安全"}),l(e,{label:"食品营养与健康",value:"食品营养与健康"}),l(e,{label:"农业资源与环境",value:"农业资源与环境"}),l(e,{label:"土地整治工程",value:"土地整治工程"}),l(e,{label:"环境生态工程",value:"环境生态工程"}),l(e,{label:"土地资源管理",value:"土地资源管理"}),l(e,{label:"人文地理与城乡规划",value:"人文地理与城乡规划"}),l(e,{label:"法学",value:"法学"}),l(e,{label:"社会工作",value:"社会工作"}),l(e,{label:"汉语国际教育",value:"汉语国际教育"}),l(e,{label:"乡村治理",value:"乡村治理"}),l(e,{label:"应用化学",value:"应用化学"}),l(e,{label:"化学生物学",value:"化学生物学"}),l(e,{label:"电子信息科学与技术",value:"电子信息科学与技术"}),l(e,{label:"物联网工程",value:"物联网工程"}),l(e,{label:"英语",value:"英语"}),l(e,{label:"翻译",value:"翻译"}),l(e,{label:"日语",value:"日语"}),l(e,{label:"商务英语",value:"商务英语"}),l(e,{label:"社会体育指导与管理",value:"社会体育指导与管理"}),l(e,{label:"环境科学",value:"环境科学"}),l(e,{label:"数据科学与大数据技术",value:"数据科学与大数据技术"}),l(e,{label:"软件工程",value:"软件工程"})]),_:1},8,["modelValue"])]),_:1})):M("",!0)]),_:1})]),i("div",J,[l(g,{data:V.value,style:{width:"100%"}},{default:s(()=>[l(o,{prop:"rank",label:"排名",width:"80"},{default:s(u=>[i("span",{class:z(N(u.row.rank))},E(u.row.rank),3)]),_:1}),l(o,{prop:"nickname",label:"昵称",width:"150"}),l(o,{prop:"college",label:"学院"}),l(o,{prop:"major",label:"专业",width:"120"}),l(o,{prop:"totalPoints",label:"总积分",width:"100"}),l(o,{prop:"uploadCount",label:"上传资料数",width:"120"})]),_:1},8,["data"])])])]),_:1})])}}},Z=U(K,[["__scopeId","data-v-6e302148"]]);export{Z as default};
