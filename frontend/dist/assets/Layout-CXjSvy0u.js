import{o as L,c as R,a as n,b as o,w as t,t as q,j as N,e as r,f,u as B,k as C,g as v,l as u,m as M,n as U,p as V,h as i,q as E,s as P,v as T,x as W,d as F,E as x}from"./index-15cpDDQA.js";import{a as w}from"./index-CKeea3vE.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z={class:"layout-container"},D={class:"sidebar"},J={class:"main-content"},O={class:"top-nav"},G={class:"nav-left"},H={class:"welcome"},K={class:"nav-right"},Q={class:"page-content"},X={__name:"Layout",setup(Y){const m=B(),g=C(),S=N(()=>{const l=g.path;return l.startsWith("/integral/")?"/integral/rules":l.startsWith("/question/")?"/question/list":l}),_=f("用户"),d=f(0),c=f(null),k=()=>{const l=localStorage.getItem("user");if(console.log("LocalStorage user info:",l),l)try{const e=JSON.parse(l);console.log("Parsed user:",e),console.log("User role:",e.role),console.log("User studentId:",e.studentId),c.value=e,_.value=e.name||e.username||"用户",d.value=e.role||0,console.log("Set userRole to:",d.value)}catch(e){console.error("解析用户信息失败:",e)}console.log("Final userRole:",d.value),console.log("Final user:",c.value)},I=l=>{m.push(l)},y=async()=>{try{console.log("开始退出登录..."),console.log("localStorage中的token:",localStorage.getItem("token")),console.log("localStorage中的user:",localStorage.getItem("user"));const l=await w.post("/user/logout");if(console.log("退出登录响应:",l),console.log("当前路由:",g.path),g.path.startsWith("/admin"))try{if(console.log("当前在Admin页面，尝试调用Admin页面的退出登录处理函数..."),window.handleAdminLogout){console.log("找到全局的handleAdminLogout函数，调用它..."),await window.handleAdminLogout(),console.log("Admin页面的退出登录处理函数调用完成");return}else{console.log("未找到全局的handleAdminLogout函数，执行默认退出流程...");const e=await w.get("/admin/login/records",{params:{page:1,pageSize:10}});console.log("强制刷新登录记录成功:",e),console.log("等待2.5秒，确保Admin页面更新..."),await new Promise(a=>setTimeout(a,2500)),console.log("等待完成，准备清除token并跳转...")}}catch(e){console.error("Admin页面退出登录处理失败:",e)}else await new Promise(e=>setTimeout(e,500));localStorage.removeItem("user"),localStorage.removeItem("token"),x.success("退出登录成功"),m.push("/login")}catch(l){console.error("退出登录失败:",l),console.error("错误详情:",l.response),console.error("错误消息:",l.message),localStorage.removeItem("user"),localStorage.removeItem("token"),x.success("退出登录成功"),m.push("/login")}};return L(()=>{k()}),(l,e)=>{const a=r("el-icon"),s=r("el-menu-item"),p=r("el-sub-menu"),h=r("el-menu"),A=r("el-button"),b=r("router-view");return v(),R("div",z,[n("div",D,[e[11]||(e[11]=n("div",{class:"logo"},[n("h1",null,"资料平台")],-1)),o(h,{"default-active":S.value,class:"el-menu-vertical-demo",onSelect:I,"background-color":"#304156","text-color":"#fff","active-text-color":"#ffd04b"},{default:t(()=>[o(s,{index:"/home"},{default:t(()=>[o(a,null,{default:t(()=>[o(u(M))]),_:1}),e[0]||(e[0]=n("span",null,"首页",-1))]),_:1}),o(s,{index:"/upload"},{default:t(()=>[o(a,null,{default:t(()=>[o(u(U))]),_:1}),e[1]||(e[1]=n("span",null,"上传资料",-1))]),_:1}),o(s,{index:"/user"},{default:t(()=>[o(a,null,{default:t(()=>[o(u(V))]),_:1}),e[2]||(e[2]=n("span",null,"个人中心",-1))]),_:1}),o(p,{index:"integral"},{title:t(()=>[o(a,null,{default:t(()=>[o(u(E))]),_:1}),e[3]||(e[3]=n("span",null,"积分管理",-1))]),default:t(()=>[o(s,{index:"/integral/rules"},{default:t(()=>[...e[4]||(e[4]=[i("积分规则",-1)])]),_:1}),o(s,{index:"/integral/center"},{default:t(()=>[...e[5]||(e[5]=[i("积分中心",-1)])]),_:1}),o(s,{index:"/integral/rank"},{default:t(()=>[...e[6]||(e[6]=[i("积分排行",-1)])]),_:1})]),_:1}),o(p,{index:"question"},{title:t(()=>[o(a,null,{default:t(()=>[o(u(P))]),_:1}),e[7]||(e[7]=n("span",null,"互动交流",-1))]),default:t(()=>[o(s,{index:"/question/add"},{default:t(()=>[...e[8]||(e[8]=[i("发布问题",-1)])]),_:1}),o(s,{index:"/question/list"},{default:t(()=>[...e[9]||(e[9]=[i("问题列表",-1)])]),_:1})]),_:1}),d.value===1||c.value&&c.value.studentId==="admin"?(v(),T(s,{key:0,index:"/admin"},{default:t(()=>[o(a,null,{default:t(()=>[o(u(W))]),_:1}),e[10]||(e[10]=n("span",null,"管理员",-1))]),_:1})):F("",!0)]),_:1},8,["default-active"])]),n("div",J,[n("div",O,[n("div",G,[n("span",H,"欢迎，"+q(_.value),1)]),n("div",K,[o(A,{type:"text",onClick:y},{default:t(()=>[...e[12]||(e[12]=[i("退出登录",-1)])]),_:1})])]),n("div",Q,[o(b)])])])}}},oe=j(X,[["__scopeId","data-v-300caee7"]]);export{oe as default};
