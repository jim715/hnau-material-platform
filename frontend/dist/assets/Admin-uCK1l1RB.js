import{M as ol,c as z,a as d,b as l,w as t,v as W,d as le,G as $e,E as ke,f as m,e as $,y as tl,u as al,g as k,l as N,p as sl,W as nl,X as rl,q as ul,x as dl,n as il,h as i,Y as Ve,t as S,H as cl,Z as ml,_ as gl,$ as pl,B as vl}from"./index-15cpDDQA.js";import{a as h}from"./index-CKeea3vE.js";import{r as fl,u as Re}from"./xlsx-BUW7exb-.js";import{_ as yl}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _l={class:"admin-container"},bl={class:"admin-menu"},Il={class:"admin-content"},wl={key:0},hl={class:"user-upload-section"},Sl={class:"login-records mt-6"},$l={key:1},kl=["onClick"],Vl={key:1,class:"no-data"},Cl={key:2},Tl={key:3},Dl={key:0,class:"no-data"},Ul={key:4},xl={class:"update-settings"},Rl={class:"update-buttons"},Al={key:5},Nl={class:"dialog-footer"},Ml={class:"dialog-footer"},Pl={class:"material-detail"},Ll={class:"description"},El={class:"file-info"},Fl={class:"dialog-footer"},zl={class:"integral-dialog"},Bl={class:"integral-actions"},ql={class:"dialog-footer"},jl={__name:"Admin",setup(Jl){const Ce=al();console.log("API模块:",h),console.log("API基础URL:",h.defaults.baseURL);const Z=m(""),oe=m(null),n=m(""),r=m("info"),te=m([]),de=m(!1),Te=m(1),ie=m(!1),D=m({}),ye=m([]),ae=m(!1),se=m(!1),M=m({name:"",description:"",parentId:0,sort:0}),P=m({id:"",name:"",description:"",parentId:0,sort:0}),Ae=m({name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}),Ne=m({name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}),_e=m([]),ce=m(!1),X=m(!1),j=m({}),J=m({points:0,reason:""}),Me=m({points:[{required:!0,message:"请输入积分变动值",trigger:"blur"}],reason:[{required:!0,message:"请输入变动原因",trigger:"blur"}]}),F=m([]),be=m(!1),O=m(0),ne=m(1),Y=m(null),U=m({updateDate:new Date,startTime:new Date,endTime:new Date}),Pe=m({updateDate:[{required:!0,message:"请选择更新日期",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}]}),Ie=m(null),H=m(!1),x=m(""),L=m("info"),B=m(null),Q=m(null),Le=(o,e)=>{console.log("菜单选择:",o),Z.value=o,o==="category-manage"?ge():o==="material-manage"?we():o==="integral-manage"?(console.log("选择了积分管理，准备获取用户列表..."),console.log("localStorage中的token:",localStorage.getItem("token")),console.log("localStorage中的user:",localStorage.getItem("user")),pe()):o==="user-manage"&&el()},Ee=async()=>{try{console.log("Admin页面开始退出登录...");const o=await h.post("/user/logout");console.log("退出登录响应:",o),console.log("强制刷新登录记录...");const e=await h.get("/admin/login/records",{params:{page:ne.value,pageSize:10}});console.log("强制刷新登录记录成功:",e),e.code===200&&e.data&&e.data.list&&(F.value=e.data.list,O.value=e.data.total||0,console.log("Admin页面登录记录已更新")),console.log("等待2秒，让用户看到更新后的退出时间..."),await new Promise(u=>setTimeout(u,2e3)),console.log("等待完成，准备清除token并跳转..."),localStorage.removeItem("user"),localStorage.removeItem("token"),ke.success("退出登录成功"),Ce.push("/login")}catch(o){console.error("退出登录失败:",o),localStorage.removeItem("user"),localStorage.removeItem("token"),ke.success("退出登录成功"),Ce.push("/login")}};window.handleAdminLogout=Ee;const we=async()=>{de.value=!0;try{const o=await h.get("/admin/material/audit/list");o.code===200?te.value=o.data:(n.value="获取待审核资料失败: "+(o.message||"未知错误"),r.value="error")}catch(o){console.error("获取待审核资料失败:",o),n.value="获取待审核资料失败，请检查网络连接",r.value="error"}finally{de.value=!1}},De=async(o,e)=>{try{const u=await h.post("/admin/material/audit",{materialId:o,auditStatus:e});u.code===200?(n.value="审核成功",r.value="success",we()):(n.value="审核失败: "+(u.message||"未知错误"),r.value="error")}catch(u){console.error("审核资料失败:",u),n.value="审核资料失败，请检查网络连接",r.value="error"}},Fe=async o=>{try{const e=await h.get(`/material/info/${o.id}`);e.code===200?(D.value=e.data,ie.value=!0):(n.value="获取资料详情失败: "+(e.message||"未知错误"),r.value="error")}catch(e){console.error("获取资料详情失败:",e),n.value="获取资料详情失败，请检查网络连接",r.value="error"}},me=o=>o?new Date(o).toLocaleString():"",ze=o=>{if(!o)return"0 B";const e=1024,u=["B","KB","MB","GB","TB"],v=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,v)).toFixed(2))+" "+u[v]},Be=o=>{Te.value=o},ge=async()=>{try{const o=await h.get("/category/list");o.code===200?ye.value=o.data:(n.value="获取分类列表失败",r.value="error")}catch(o){console.error("获取分类列表失败:",o),n.value="获取分类列表失败",r.value="error"}},qe=()=>{M.value={name:"",description:"",parentId:0,sort:0},ae.value=!0},je=o=>{P.value={id:o.id,name:o.name,description:o.description,parentId:o.parentId,sort:o.sort},se.value=!0},Je=async()=>{try{const o=await h.post("/category/create",M.value);o.code===200?(n.value="添加分类成功",r.value="success",ae.value=!1,ge()):(n.value="添加分类失败: "+(o.message||"未知错误"),r.value="error")}catch(o){console.error("添加分类失败:",o),n.value="添加分类失败",r.value="error"}},Oe=async()=>{try{const o=await h.put("/category/update",P.value);o.code===200?(n.value="编辑分类成功",r.value="success",se.value=!1,ge()):(n.value="编辑分类失败: "+(o.message||"未知错误"),r.value="error")}catch(o){console.error("编辑分类失败:",o),n.value="编辑分类失败",r.value="error"}},He=async o=>{try{const e=await h.delete(`/category/delete/${o}`);e.code===200?(n.value="删除分类成功",r.value="success",ge()):(n.value="删除分类失败: "+(e.message||"未知错误"),r.value="error")}catch(e){console.error("删除分类失败:",e),n.value="删除分类失败",r.value="error"}},Ge=(o,e)=>{oe.value=o.raw,n.value=""},Ze=async()=>{if(!oe.value){n.value="请先选择Excel文件",r.value="warning";return}const o=new FileReader;o.onload=async e=>{try{console.log("开始解析Excel文件");const u=new Uint8Array(e.target.result);console.log("读取文件数据成功，长度:",u.length);const v=fl(u,{type:"array"});console.log("解析工作簿成功，工作表数量:",v.SheetNames.length);const E=v.SheetNames[0];console.log("使用工作表:",E);const b=v.Sheets[E];console.log("获取工作表成功");const Se=Re.decode_range(b["!ref"]||"A1:A1");console.log("工作表原始范围:",b["!ref"],"解析后范围:",Se);const re=Re.sheet_to_json(b,{header:1});console.log("原始JSON数据（数组格式）行数:",re.length),console.log("原始JSON数据（数组格式）:",re);const p=re.filter(a=>{if(!a||a.length===0)return!1;const g=a.some(f=>f!=null&&String(f).trim()!=="");return console.log("过滤检查 - 原始数据:",a,"结果:",g),g});console.log("过滤后的数据行数:",p.length),console.log("过滤后的数据:",p);const q=p.map((a,T)=>{let g="",f="",I="",V="",w="",C="";console.log(`=== 开始解析第${T+2}行数据 ===`),console.log("原始数据:",a);const ue=String(a[0]||"").trim();if(["学号","姓名","年级","专业","学院","班级","class","grade","major","college","student_id","studentid"].includes(ue))return console.log("跳过标题行:",a),{studentId:"",name:"",grade:"",major:"",college:"",className:""};for(let y=0;y<a.length;y++){const c=String(a[y]||"").trim();if(console.log(`处理单元格[${y}]: "${c}"`),!g||!f){if(c){const _=String(c||"").trim(),A=_.match(/^(\d+)\s*([\u4e00-\u9fa5]+)$/);A&&A.length===3?(console.log(`检测到学号和姓名在同一单元格: "${_}"`),g=A[1],f=A[2],console.log(`从同一单元格分离 - 学号: "${g}", 姓名: "${f}"`)):!g&&/^\d+$/.test(_)?(g=_,console.log(`提取学号: ${g}`)):!f&&_&&!/^\d+$/.test(_)&&(f=_,console.log(`提取姓名: ${f}`))}}else!I&&c?(I=c,console.log(`提取年级: ${I}`)):!V&&c?(V=c,console.log(`提取专业: ${V}`)):!w&&c?(w=c,console.log(`提取学院: ${w}`)):!C&&c&&(C=c,console.log(`提取班级: ${C}`))}if(g&&f)for(let y=0;y<a.length;y++){const c=String(a[y]||"").trim();c&&!/^\d+[\u4e00-\u9fa5]+$/.test(c)&&!/^\d+$/.test(c)&&!/^[\u4e00-\u9fa5]+$/.test(c)&&(I?V?w?C||(C=c,console.log(`补充提取班级: ${C}`)):(w=c,console.log(`补充提取学院: ${w}`)):(V=c,console.log(`补充提取专业: ${V}`)):(I=c,console.log(`补充提取年级: ${I}`)))}if(!g||!f){console.log(`需要从值中提取数据，当前学号: "${g}", 姓名: "${f}"`);const y=a;console.log(`尝试从值中提取数据，值数量: ${y.length}`,y);const c=[[0,1,2,3,4,5],[1,0,2,3,4,5],[0,1,3,2,4,5],[0,1,2,4,3,5],[0,1,4,2,3,5],[0,1,5,2,3,4]];for(const _ of c)if(y.length>Math.max(..._)){const A=String(y[_[0]]||"").trim(),ee=String(y[_[1]]||"").trim();if(console.log(`尝试顺序 ${_}: 学号="${A}", 姓名="${ee}"`),A&&ee&&/^\d+$/.test(A)){g=A,f=ee,I=String(y[_[2]]||"").trim(),V=String(y[_[3]]||"").trim(),w=String(y[_[4]]||"").trim(),C=String(y[_[5]]||"").trim(),console.log(`从值中提取数据成功，使用顺序: ${_}`,{studentId:g,name:f,grade:I,major:V,college:w,className:C});break}}}if(!g||!f){console.log("尝试特殊处理，直接从原始数据中提取学号和姓名");const y=a;for(let c=0;c<y.length;c++){const _=String(y[c]||"").trim();if(console.log(`处理值[${c}]: "${_}"`),!g||!f)if(_&&/^\s*\d+\s*[\u4e00-\u9fa5]+\s*$/.test(_)){console.log(`检测到学号和姓名在同一单元格: "${_}"`);const A=_.match(/\d+/),ee=_.match(/[\u4e00-\u9fa5]+/);A&&ee&&(g=A[0],f=ee[0],console.log(`从同一单元格分离 - 学号: "${g}", 姓名: "${f}"`))}else!g&&/^\d+$/.test(_)?(g=_,console.log(`特殊处理：提取学号: ${g}`)):!f&&_&&!/^\d+$/.test(_)&&(f=_,console.log(`特殊处理：提取姓名: ${f}`));if(g&&f){c+1<y.length&&(I=String(y[c+1]||"").trim()),c+2<y.length&&(V=String(y[c+2]||"").trim()),c+3<y.length&&(w=String(y[c+3]||"").trim()),c+4<y.length&&(C=String(y[c+4]||"").trim()),console.log("特殊处理成功，提取到完整信息:",{studentId:g,name:f,grade:I,major:V,college:w,className:C});break}}}const G={studentId:g,name:f,grade:I,major:V,college:w,className:C};return console.log(`解析第${T+2}行数据完成:`,{original:a,parsed:G}),console.log(`=== 解析第${T+2}行数据结束 ===`),G}).filter(a=>{const T=a.studentId&&String(a.studentId).trim()!==""&&String(a.studentId).trim()!=="0",g=a.name&&String(a.name).trim()!=="",f=T&&/^\d+$/.test(String(a.studentId).trim()),I=T&&g&&f;return I?console.log("验证通过用户:",a):(console.log("过滤掉无效用户:",a),console.log("验证结果 - 有学号:",T,"有姓名:",g,"学号有效:",f),console.log("学号详细信息:",{value:a.studentId,type:typeof a.studentId,trimmed:a.studentId?String(a.studentId).trim():"",isEmpty:!a.studentId||String(a.studentId).trim()==="",isZero:a.studentId&&String(a.studentId).trim()==="0",isNumber:a.studentId&&/^\d+$/.test(String(a.studentId).trim())}),console.log("姓名详细信息:",{value:a.name,type:typeof a.name,trimmed:a.name?String(a.name).trim():"",isEmpty:!a.name||String(a.name).trim()===""})),I});if(console.log("转换后的用户数据:",q),console.log("最终处理用户数量:",q.length),q.length===0){n.value="Excel文件中没有有效的学生信息",r.value="warning";return}console.log("开始获取已有的用户列表...");let fe=[];try{const a=await h.get("/admin/user/list");console.log("获取已有的用户列表响应:",a),a.code===200&&(fe=a.data)}catch(a){console.error("获取已有的用户列表失败:",a),console.error("错误消息:",a.message),n.value="获取用户列表失败: "+a.message,r.value="error";return}const R=q.filter(a=>{const T=a.studentId&&String(a.studentId).trim()!==""&&/^\d+$/.test(String(a.studentId).trim()),g=a.name&&String(a.name).trim()!=="";return T&&g});console.log("最终发送的有效用户数量:",R.length),console.log("最终发送的用户数据:",R),console.log("开始发送批量创建用户请求"),console.log("用户数量:",R.length),console.log("准备发送的用户数据:",R);let K;if(R.length>0)try{console.log("发送POST请求到 /admin/user/batch"),console.log("确认发送的用户数量:",R.length),K=await h.post("/admin/user/batch",R),console.log("批量创建用户请求响应:",K)}catch(a){console.error("批量创建用户请求失败:",a),console.error("错误消息:",a.message),console.error("错误响应:",a.response),n.value="批量上传失败: "+a.message,r.value="error";return}else K={code:200};if(K.code===200){let a="学生信息上传成功";a+=`，处理了 ${R.length} 个用户`,n.value=a,r.value="success",oe.value=null,setTimeout(()=>{ke.success(`学生信息上传成功！
系统已处理 ${R.length} 个用户
- 新用户将被创建，默认密码为123456
- 已存在的用户信息将被更新为最新信息
- 信息有变动的用户密码将重置为123456
- 信息无变动的用户保持原有密码不变`)},1e3)}else n.value="学生信息上传失败: "+(K.message||"未知错误"),r.value="error"}catch(u){console.error("解析Excel文件失败:",u),console.error("错误堆栈:",u.stack),n.value="解析Excel文件失败，请检查文件格式: "+u.message+`
错误堆栈: `+u.stack,r.value="error"}},o.onerror=e=>{console.error("文件读取失败:",e),console.error("错误堆栈:",e.stack),n.value="文件读取失败，请检查文件: "+e.message,r.value="error"},o.readAsArrayBuffer(oe.value)},pe=async()=>{ce.value=!0;try{console.log("开始获取用户列表..."),console.log("API请求URL:","/admin/user/list"),console.log("API基础URL:",h.defaults.baseURL);const o=h.defaults.baseURL+"/admin/user/list";console.log("完整请求URL:",o),console.log("localStorage中的token:",localStorage.getItem("token")),console.log("localStorage中的user:",localStorage.getItem("user"));const e=await h.get("/admin/user/list");if(console.log("获取用户列表响应:",e),e.code===200){console.log("获取用户列表成功，数据:",e.data),e.data.forEach((v,E)=>{console.log(`用户 ${E+1}: 学号=${v.studentId}, 姓名=${v.name}, className=${v.className}`),console.log(`用户 ${E+1} 所有字段:`,v)});const u=e.data.sort((v,E)=>v.studentId.localeCompare(E.studentId));console.log("排序后的用户列表:",u),u.forEach((v,E)=>{console.log(`排序后用户 ${E+1}: className=${v.className}, 类型=${typeof v.className}`)}),_e.value=u}else console.error("获取用户列表失败:",e.message||"未知错误"),n.value="获取用户列表失败: "+(e.message||"未知错误"),r.value="error"}catch(o){console.error("获取用户列表异常:",o),console.error("异常详情:",o.response),console.error("异常消息:",o.message),n.value="获取用户列表失败，请检查网络连接",r.value="error"}finally{ce.value=!1}},Ke=o=>{j.value=o,J.value={points:0,reason:""},X.value=!0},We=async()=>{try{const o=await h.post("/admin/integral/update",{userId:j.value.id,points:parseInt(J.value.points),reason:J.value.reason});o.code===200?(n.value="积分修改成功",r.value="success",X.value=!1,pe()):(n.value="积分修改失败: "+(o.message||"未知错误"),r.value="error")}catch(o){console.error("修改积分失败:",o),n.value="修改积分失败，请检查网络连接",r.value="error"}},Xe=async()=>{try{const o=await h.post("/admin/integral/clear",{userId:j.value.id});o.code===200?(n.value="积分清除成功",r.value="success",X.value=!1,pe()):(n.value="积分清除失败: "+(o.message||"未知错误"),r.value="error")}catch(o){console.error("清除积分失败:",o),n.value="清除积分失败，请检查网络连接",r.value="error"}},Ye=async()=>{try{console.log("开始测试API...");const o=await h.get("/admin/test");console.log("测试API响应:",o),o.code===200?(n.value="测试API调用成功",r.value="success"):(n.value="测试API调用失败: "+(o.message||"未知错误"),r.value="error")}catch(o){console.error("测试API异常:",o),n.value="测试API调用失败，请检查网络连接",r.value="error"}},ve=async()=>{be.value=!0;try{console.log("开始获取登录记录..."),console.log("请求参数:",{page:ne.value,pageSize:10});const o=localStorage.getItem("token");if(console.log("使用的token:",o),!o){console.error("未登录，token为空"),n.value="获取登录记录失败: 未登录",r.value="error",F.value=[],O.value=0,Ue();return}const e=await h.get("/admin/login/records",{params:{page:ne.value,pageSize:10}});console.log("登录记录响应:",e),console.log("响应类型:",typeof e),e&&e.code===200?e.data?(console.log("响应data:",e.data),e.data.list?(console.log("获取登录记录成功，记录数:",e.data.list.length),F.value=e.data.list,O.value=e.data.total||0,n.value=""):(console.error("响应data中没有list字段"),n.value="获取登录记录失败: 数据结构不正确",r.value="error",F.value=[],O.value=0)):(console.error("响应中没有data字段"),n.value="获取登录记录失败: 数据结构不正确",r.value="error",F.value=[],O.value=0):(console.error("响应code不是200:",e==null?void 0:e.code),n.value="获取登录记录失败: "+((e==null?void 0:e.message)||"未知错误"),r.value="error",F.value=[],O.value=0)}catch(o){console.error("获取登录记录失败:",o),console.error("错误消息:",o.message),console.error("错误堆栈:",o.stack),n.value="获取登录记录失败，请检查网络连接",r.value="error",F.value=[],O.value=0}finally{be.value=!1}},Qe=o=>{ne.value=o,ve()},el=()=>{Y.value&&clearInterval(Y.value),ve(),Y.value=setInterval(()=>{ve()},5e3),console.log("登录记录自动刷新已启动")},Ue=()=>{Y.value&&(clearInterval(Y.value),Y.value=null,console.log("登录记录自动刷新已停止"))},ll=async()=>{Ie.value&&await Ie.value.validate(async o=>{if(o)try{const e=new Date(U.value.startTime),u=new Date,v=e.getTime()-u.getTime();console.log("开始时间:",e),console.log("当前时间:",u),console.log("开始时间差(毫秒):",v),v>0?(x.value=`系统将在 ${e.toLocaleString()} 开始更新`,L.value="info",Q.value&&clearTimeout(Q.value),Q.value=setTimeout(async()=>{console.log("到达开始时间，自动执行开始更新..."),await xe()},v),console.log("开始更新定时器已设置，将在",e,"自动执行")):await xe()}catch(e){console.error("系统更新开始失败:",e),x.value="系统更新开始失败，请检查网络连接",L.value="error",H.value=!1}})},xe=async()=>{try{H.value=!0,x.value="系统开始更新，正在强制所有用户退出...",L.value="warning",console.log("开始强制所有用户退出...");const o=await h.post("/admin/system/update/start",{updateDate:U.value.updateDate,startTime:U.value.startTime,endTime:U.value.endTime});if(o.code===200){x.value="系统更新开始成功，所有用户已被强制退出",L.value="success",console.log("系统更新开始成功，管理员可以继续操作"),console.log("设置更新完成定时器...");const e=new Date(U.value.endTime),u=new Date,v=e.getTime()-u.getTime();v>0?(console.log("结束时间:",e),console.log("当前时间:",u),console.log("结束时间差(毫秒):",v),B.value&&clearTimeout(B.value),B.value=setTimeout(async()=>{console.log("到达结束时间，自动调用更新完成方法..."),await he()},v),console.log("更新完成定时器已设置，将在",e,"自动执行")):(console.log("结束时间已过，立即调用更新完成方法..."),await he())}else x.value="系统更新开始失败: "+(o.message||"未知错误"),L.value="error",H.value=!1}catch(o){console.error("系统更新执行失败:",o),x.value="系统更新执行失败，请检查网络连接",L.value="error",H.value=!1}},he=async()=>{try{x.value="正在完成系统更新...",L.value="info",B.value&&(clearTimeout(B.value),B.value=null,console.log("更新完成定时器已清除")),console.log("完成系统更新...");const o=await h.post("/admin/system/update/complete");o.code===200?(x.value="系统更新完成，所有功能已恢复正常",L.value="success",H.value=!1):(x.value="系统更新完成失败: "+(o.message||"未知错误"),L.value="error")}catch(o){console.error("系统更新完成失败:",o),x.value="系统更新完成失败，请检查网络连接",L.value="error"}};return ol(()=>{Ue(),B.value&&(clearTimeout(B.value),B.value=null,console.log("更新完成定时器已清除")),Q.value&&(clearTimeout(Q.value),Q.value=null,console.log("开始更新定时器已清除")),console.log("Admin组件已卸载，定时器已清理")}),(o,e)=>{const u=$("el-icon"),v=$("el-menu-item"),E=$("el-menu"),b=$("el-button"),Se=$("el-upload"),re=$("el-alert"),p=$("el-table-column"),q=$("el-table"),fe=$("el-pagination"),R=$("el-empty"),K=$("el-date-picker"),a=$("el-form-item"),T=$("el-time-picker"),g=$("el-form"),f=$("el-card"),I=$("el-input"),V=$("el-dialog"),w=$("el-descriptions-item"),C=$("el-descriptions"),ue=tl("loading");return k(),z("div",_l,[d("div",bl,[l(E,{"default-active":Z.value,class:"el-menu-vertical-demo",onSelect:Le},{default:t(()=>[l(v,{index:"user-manage"},{default:t(()=>[l(u,null,{default:t(()=>[l(N(sl))]),_:1}),e[21]||(e[21]=d("span",null,"用户管理",-1))]),_:1}),l(v,{index:"material-manage"},{default:t(()=>[l(u,null,{default:t(()=>[l(N(nl))]),_:1}),e[22]||(e[22]=d("span",null,"资料管理",-1))]),_:1}),l(v,{index:"category-manage"},{default:t(()=>[l(u,null,{default:t(()=>[l(N(rl))]),_:1}),e[23]||(e[23]=d("span",null,"分类管理",-1))]),_:1}),l(v,{index:"integral-manage"},{default:t(()=>[l(u,null,{default:t(()=>[l(N(ul))]),_:1}),e[24]||(e[24]=d("span",null,"积分管理",-1))]),_:1}),l(v,{index:"system-setting"},{default:t(()=>[l(u,null,{default:t(()=>[l(N(dl))]),_:1}),e[25]||(e[25]=d("span",null,"系统设置",-1))]),_:1})]),_:1},8,["default-active"])]),d("div",Il,[Z.value==="user-manage"?(k(),z("div",wl,[e[31]||(e[31]=d("h2",null,"用户管理",-1)),d("div",hl,[l(Se,{class:"user-upload",action:"","on-change":Ge,"auto-upload":!1,accept:".xlsx, .xls",multiple:""},{tip:t(()=>[...e[27]||(e[27]=[d("div",{class:"el-upload__tip"}," 请上传包含学生信息的Excel文件，支持.xlsx和.xls格式 ",-1)])]),default:t(()=>[l(b,{type:"primary"},{default:t(()=>[l(u,null,{default:t(()=>[l(N(il))]),_:1}),e[26]||(e[26]=i(" 上传学生信息Excel文件 ",-1))]),_:1})]),_:1}),l(b,{type:"success",onClick:Ze,disabled:!oe.value,class:"ml-4"},{default:t(()=>[...e[28]||(e[28]=[i(" 确认上传 ",-1)])]),_:1},8,["disabled"])]),n.value?(k(),W(re,{key:0,title:n.value,type:r.value,"show-icon":"",class:"mt-4"},null,8,["title","type"])):le("",!0),d("div",Sl,[e[30]||(e[30]=d("h3",null,"登录记录",-1)),l(b,{type:"primary",onClick:ve,class:"mb-4"},{default:t(()=>[l(u,null,{default:t(()=>[l(N(Ve))]),_:1}),e[29]||(e[29]=i(" 刷新登录记录 ",-1))]),_:1}),$e((k(),W(q,{data:F.value,style:{width:"100%"}},{default:t(()=>[l(p,{prop:"id",label:"ID",width:"80"}),l(p,{prop:"username",label:"用户名",width:"120"}),l(p,{prop:"studentId",label:"学号",width:"150"}),l(p,{prop:"loginTime",label:"登录时间",width:"180"},{default:t(s=>[i(S(me(s.row.loginTime)),1)]),_:1}),l(p,{prop:"device",label:"登录设备","min-width":"200"}),l(p,{prop:"ipAddress",label:"IP地址",width:"150"}),l(p,{prop:"logoutTime",label:"退出时间",width:"180"},{default:t(s=>[i(S(s.row.logoutTime?me(s.row.logoutTime):"-"),1)]),_:1}),l(p,{prop:"status",label:"状态",width:"100"},{default:t(s=>[i(S(s.row.status===0?"在线":"已退出"),1)]),_:1})]),_:1},8,["data"])),[[ue,be.value]]),F.value&&F.value.length>0?(k(),W(fe,{key:0,layout:"prev, pager, next",total:O.value,"page-size":10,"current-page":ne.value,onCurrentChange:Qe,class:"mt-4"},null,8,["total","current-page"])):le("",!0)])])):Z.value==="material-manage"?(k(),z("div",$l,[e[35]||(e[35]=d("h2",null,"资料管理",-1)),l(b,{type:"primary",onClick:we},{default:t(()=>[l(u,null,{default:t(()=>[l(N(Ve))]),_:1}),e[32]||(e[32]=i(" 刷新待审核列表 ",-1))]),_:1}),$e((k(),W(q,{data:te.value,style:{width:"100%"}},{default:t(()=>[l(p,{prop:"id",label:"ID",width:"80"}),l(p,{prop:"name",label:"资料名称","min-width":"200"},{default:t(s=>[d("a",{href:"#",onClick:cl(G=>Fe(s.row),["prevent"])},S(s.row.name),9,kl)]),_:1}),l(p,{prop:"categoryId",label:"分类ID",width:"100"}),l(p,{prop:"userId",label:"上传用户ID",width:"120"}),l(p,{prop:"createTime",label:"上传时间",width:"180"},{default:t(s=>[i(S(me(s.row.createTime)),1)]),_:1}),l(p,{label:"操作",width:"180"},{default:t(s=>[l(b,{type:"success",size:"small",onClick:G=>De(s.row.id,1)},{default:t(()=>[...e[33]||(e[33]=[i(" 通过 ",-1)])]),_:1},8,["onClick"]),l(b,{type:"danger",size:"small",onClick:G=>De(s.row.id,2)},{default:t(()=>[...e[34]||(e[34]=[i(" 驳回 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,de.value]]),te.value.length>0?(k(),W(fe,{key:0,layout:"prev, pager, next",total:te.value.length,"page-size":10,"current-page":Te.value,onCurrentChange:Be,class:"mt-4"},null,8,["total","current-page"])):le("",!0),te.value.length===0&&!de.value?(k(),z("div",Vl,[l(R,{description:"暂无待审核资料"})])):le("",!0)])):Z.value==="category-manage"?(k(),z("div",Cl,[e[39]||(e[39]=d("h2",null,"分类管理",-1)),l(b,{type:"primary",onClick:qe},{default:t(()=>[l(u,null,{default:t(()=>[l(N(ml))]),_:1}),e[36]||(e[36]=i(" 添加分类 ",-1))]),_:1}),(k(),W(q,{data:ye.value,style:{width:"100%"},key:ye.value.length},{default:t(()=>[l(p,{prop:"id",label:"分类ID",width:"80"}),l(p,{prop:"name",label:"分类名称"}),l(p,{prop:"description",label:"分类描述"}),l(p,{prop:"parentId",label:"父分类ID",width:"120"}),l(p,{prop:"sort",label:"排序",width:"80"}),l(p,{label:"操作",width:"150"},{default:t(s=>[l(b,{type:"primary",size:"small",onClick:G=>je(s.row)},{default:t(()=>[l(u,null,{default:t(()=>[l(N(gl))]),_:1}),e[37]||(e[37]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),l(b,{type:"danger",size:"small",onClick:G=>He(s.row.id)},{default:t(()=>[l(u,null,{default:t(()=>[l(N(pl))]),_:1}),e[38]||(e[38]=i(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))])):Z.value==="integral-manage"?(k(),z("div",Tl,[e[43]||(e[43]=d("h2",null,"积分管理",-1)),l(b,{type:"primary",onClick:pe},{default:t(()=>[l(u,null,{default:t(()=>[l(N(Ve))]),_:1}),e[40]||(e[40]=i(" 刷新用户列表 ",-1))]),_:1}),l(b,{type:"success",onClick:Ye},{default:t(()=>[...e[41]||(e[41]=[i(" 测试API ",-1)])]),_:1}),$e((k(),W(q,{data:_e.value,style:{width:"100%"}},{default:t(()=>[l(p,{prop:"id",label:"用户ID",width:"100"}),l(p,{prop:"studentId",label:"学号",width:"150"}),l(p,{prop:"name",label:"姓名",width:"120"}),l(p,{prop:"college",label:"学院"}),l(p,{prop:"major",label:"专业"}),l(p,{label:"班级",width:"120"},{default:t(s=>[i(S(s.row.className||"未设置"),1)]),_:1}),l(p,{prop:"points",label:"当前积分",width:"120"}),l(p,{label:"操作",width:"180"},{default:t(s=>[l(b,{type:"primary",size:"small",onClick:G=>Ke(s.row)},{default:t(()=>[...e[42]||(e[42]=[i(" 操作积分 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,ce.value]]),_e.value.length===0&&!ce.value?(k(),z("div",Dl,[l(R,{description:"暂无用户数据"})])):le("",!0)])):Z.value==="system-setting"?(k(),z("div",Ul,[e[46]||(e[46]=d("h2",null,"系统设置",-1)),l(f,{class:"system-update-card"},{header:t(()=>[...e[44]||(e[44]=[d("div",{class:"card-header"},[d("span",null,"系统更新设置")],-1)])]),default:t(()=>[d("div",xl,[l(g,{model:U.value,rules:Pe.value,ref_key:"updateFormRef",ref:Ie},{default:t(()=>[l(a,{label:"更新日期",prop:"updateDate"},{default:t(()=>[l(K,{modelValue:U.value.updateDate,"onUpdate:modelValue":e[0]||(e[0]=s=>U.value.updateDate=s),type:"date",placeholder:"选择更新日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(a,{label:"开始时间",prop:"startTime"},{default:t(()=>[l(T,{modelValue:U.value.startTime,"onUpdate:modelValue":e[1]||(e[1]=s=>U.value.startTime=s),placeholder:"选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(a,{label:"结束时间",prop:"endTime"},{default:t(()=>[l(T,{modelValue:U.value.endTime,"onUpdate:modelValue":e[2]||(e[2]=s=>U.value.endTime=s),placeholder:"选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),d("div",Rl,[l(b,{type:"danger",onClick:ll,disabled:H.value},{default:t(()=>[i(S(H.value?"更新中...":"开始更新"),1)]),_:1},8,["disabled"]),l(b,{type:"success",onClick:he,disabled:!H.value},{default:t(()=>[...e[45]||(e[45]=[i(" 更新完成 ",-1)])]),_:1},8,["disabled"])]),x.value?(k(),z("div",{key:0,class:vl(["update-message",L.value])},S(x.value),3)):le("",!0)])]),_:1})])):(k(),z("div",Al,[...e[47]||(e[47]=[d("h2",null,"欢迎",-1),d("p",null,"请选择左侧菜单进行操作",-1)])])),l(V,{modelValue:ae.value,"onUpdate:modelValue":e[8]||(e[8]=s=>ae.value=s),title:"添加分类",width:"500px"},{footer:t(()=>[d("span",Nl,[l(b,{onClick:e[7]||(e[7]=s=>ae.value=!1)},{default:t(()=>[...e[48]||(e[48]=[i("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:Je},{default:t(()=>[...e[49]||(e[49]=[i("确定",-1)])]),_:1})])]),default:t(()=>[l(g,{model:M.value,rules:Ae.value,ref:"addCategoryFormRef"},{default:t(()=>[l(a,{label:"分类名称",prop:"name"},{default:t(()=>[l(I,{modelValue:M.value.name,"onUpdate:modelValue":e[3]||(e[3]=s=>M.value.name=s),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),l(a,{label:"分类描述",prop:"description"},{default:t(()=>[l(I,{modelValue:M.value.description,"onUpdate:modelValue":e[4]||(e[4]=s=>M.value.description=s),placeholder:"请输入分类描述",type:"textarea"},null,8,["modelValue"])]),_:1}),l(a,{label:"父分类ID",prop:"parentId"},{default:t(()=>[l(I,{modelValue:M.value.parentId,"onUpdate:modelValue":e[5]||(e[5]=s=>M.value.parentId=s),placeholder:"请输入父分类ID，根分类为0",type:"number"},null,8,["modelValue"])]),_:1}),l(a,{label:"排序",prop:"sort"},{default:t(()=>[l(I,{modelValue:M.value.sort,"onUpdate:modelValue":e[6]||(e[6]=s=>M.value.sort=s),placeholder:"请输入排序",type:"number"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(V,{modelValue:se.value,"onUpdate:modelValue":e[14]||(e[14]=s=>se.value=s),title:"编辑分类",width:"500px"},{footer:t(()=>[d("span",Ml,[l(b,{onClick:e[13]||(e[13]=s=>se.value=!1)},{default:t(()=>[...e[50]||(e[50]=[i("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:Oe},{default:t(()=>[...e[51]||(e[51]=[i("确定",-1)])]),_:1})])]),default:t(()=>[l(g,{model:P.value,rules:Ne.value,ref:"editCategoryFormRef"},{default:t(()=>[l(a,{label:"分类名称",prop:"name"},{default:t(()=>[l(I,{modelValue:P.value.name,"onUpdate:modelValue":e[9]||(e[9]=s=>P.value.name=s),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),l(a,{label:"分类描述",prop:"description"},{default:t(()=>[l(I,{modelValue:P.value.description,"onUpdate:modelValue":e[10]||(e[10]=s=>P.value.description=s),placeholder:"请输入分类描述",type:"textarea"},null,8,["modelValue"])]),_:1}),l(a,{label:"父分类ID",prop:"parentId"},{default:t(()=>[l(I,{modelValue:P.value.parentId,"onUpdate:modelValue":e[11]||(e[11]=s=>P.value.parentId=s),placeholder:"请输入父分类ID，根分类为0",type:"number"},null,8,["modelValue"])]),_:1}),l(a,{label:"排序",prop:"sort"},{default:t(()=>[l(I,{modelValue:P.value.sort,"onUpdate:modelValue":e[12]||(e[12]=s=>P.value.sort=s),placeholder:"请输入排序",type:"number"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(V,{modelValue:ie.value,"onUpdate:modelValue":e[16]||(e[16]=s=>ie.value=s),title:D.value.name||"资料详情",width:"80%"},{footer:t(()=>[d("span",Fl,[l(b,{onClick:e[15]||(e[15]=s=>ie.value=!1)},{default:t(()=>[...e[54]||(e[54]=[i("关闭",-1)])]),_:1})])]),default:t(()=>[d("div",Pl,[l(C,{column:2,border:""},{default:t(()=>[l(w,{label:"资料ID"},{default:t(()=>[i(S(D.value.id),1)]),_:1}),l(w,{label:"上传用户ID"},{default:t(()=>[i(S(D.value.userId),1)]),_:1}),l(w,{label:"分类ID"},{default:t(()=>[i(S(D.value.categoryId),1)]),_:1}),l(w,{label:"上传时间"},{default:t(()=>[i(S(me(D.value.createTime)),1)]),_:1}),l(w,{label:"文件大小"},{default:t(()=>[i(S(ze(D.value.fileSize)),1)]),_:1}),l(w,{label:"审核状态"},{default:t(()=>[i(S(D.value.auditStatus===0?"待审核":D.value.auditStatus===1?"已通过":"已驳回"),1)]),_:1})]),_:1}),d("div",Ll,[e[52]||(e[52]=d("h3",null,"资料描述",-1)),d("p",null,S(D.value.description||"无描述"),1)]),d("div",El,[e[53]||(e[53]=d("h3",null,"文件信息",-1)),d("p",null,"文件路径: "+S(D.value.filePath),1),d("p",null,"文件名: "+S(D.value.fileName),1)])])]),_:1},8,["modelValue","title"]),l(V,{modelValue:X.value,"onUpdate:modelValue":e[20]||(e[20]=s=>X.value=s),title:`积分操作 - ${j.value.name||""}`,width:"500px"},{footer:t(()=>[d("span",ql,[l(b,{onClick:e[19]||(e[19]=s=>X.value=!1)},{default:t(()=>[...e[56]||(e[56]=[i("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:We},{default:t(()=>[...e[57]||(e[57]=[i("改变积分",-1)])]),_:1}),l(b,{type:"danger",onClick:Xe},{default:t(()=>[...e[58]||(e[58]=[i("清除积分",-1)])]),_:1})])]),default:t(()=>[d("div",zl,[l(C,{column:2,border:""},{default:t(()=>[l(w,{label:"用户ID"},{default:t(()=>[i(S(j.value.id),1)]),_:1}),l(w,{label:"学号"},{default:t(()=>[i(S(j.value.studentId),1)]),_:1}),l(w,{label:"姓名"},{default:t(()=>[i(S(j.value.name),1)]),_:1}),l(w,{label:"当前积分"},{default:t(()=>[i(S(j.value.points||0),1)]),_:1})]),_:1}),d("div",Bl,[e[55]||(e[55]=d("h3",null,"操作选项",-1)),l(g,{model:J.value,rules:Me.value,ref:"integralFormRef"},{default:t(()=>[l(a,{label:"改变积分",prop:"points"},{default:t(()=>[l(I,{modelValue:J.value.points,"onUpdate:modelValue":e[17]||(e[17]=s=>J.value.points=s),placeholder:"请输入积分变动值（正数增加，负数减少）",type:"number"},null,8,["modelValue"])]),_:1}),l(a,{label:"变动原因",prop:"reason"},{default:t(()=>[l(I,{modelValue:J.value.reason,"onUpdate:modelValue":e[18]||(e[18]=s=>J.value.reason=s),placeholder:"请输入积分变动原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])])]),_:1},8,["modelValue","title"])])])}}},Kl=yl(jl,[["__scopeId","data-v-f6b5d1b4"]]);export{Kl as default};
