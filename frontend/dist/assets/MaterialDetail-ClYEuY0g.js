import{o as B,c as k,G as S,v as p,w as o,i as D,E as i,y as E,f as y,e as f,k as L,u as R,g as c,a,t as r,b as u,h as v,F as O,A as T,l as C,I as V}from"./index-2wzUmdul.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"material-detail-container"},J={class:"detail-content"},U={class:"material-title"},$={class:"material-info"},j={class:"info-item"},z={class:"info-item"},G={class:"info-item"},q={class:"material-description"},H={class:"material-tags"},K={class:"material-actions"},P={__name:"MaterialDetail",setup(Q){const w=L(),g=R(),t=y({}),m=y(!0),d=y(!1),I=s=>s?new Date(s).toLocaleString():"",x=async()=>{m.value=!0;try{const s=w.params.id,e=await D.get(`/api/material/${s}`);e.data.code===200?t.value=e.data.data:(i.error(e.data.message),g.push("/home"))}catch(s){console.error("获取资料详情失败:",s),i.error("获取资料详情失败，请检查网络连接"),g.push("/home")}finally{m.value=!1}},M=async()=>{const s=localStorage.getItem("user");if(!s){i.error("请先登录"),g.push("/login");return}d.value=!0;try{const e=w.params.id,n=JSON.parse(s),_=await D.get(`/api/material/download/${e}`,{params:{userId:n.id},responseType:"blob"}),h=window.URL.createObjectURL(new Blob([_.data])),l=document.createElement("a");l.href=h,l.setAttribute("download",t.value.name),document.body.appendChild(l),l.click(),document.body.removeChild(l),i.success("下载成功"),t.value.downloadCount++}catch(e){if(console.error("下载资料失败:",e),e.response)try{const n=JSON.parse(e.response.data);i.error(n.message)}catch{i.error("下载失败，请检查网络连接")}else i.error("下载失败，请检查网络连接")}finally{d.value=!1}};return B(()=>{x()}),(s,e)=>{const n=f("el-tag"),_=f("el-icon"),h=f("el-button"),l=f("el-card"),N=E("loading");return c(),k("div",F,[S((c(),p(l,{class:"detail-card"},{header:o(()=>[...e[0]||(e[0]=[a("div",{class:"card-header"},[a("span",null,"资料详情")],-1)])]),default:o(()=>[a("div",J,[a("h2",U,r(t.value.name),1),a("div",$,[u(n,null,{default:o(()=>[v(r(t.value.categoryName),1)]),_:1}),a("span",j,"上传时间："+r(I(t.value.uploadTime)),1),a("span",z,"浏览次数："+r(t.value.viewCount),1),a("span",G,"下载次数："+r(t.value.downloadCount),1)]),a("div",q,[e[1]||(e[1]=a("h3",null,"资料描述",-1)),a("p",null,r(t.value.description),1)]),a("div",H,[e[2]||(e[2]=a("h3",null,"标签",-1)),(c(!0),k(O,null,T(t.value.tags,b=>(c(),p(n,{key:b.id,effect:"plain"},{default:o(()=>[v(r(b.name),1)]),_:2},1024))),128))]),a("div",K,[u(h,{type:"primary",size:"large",onClick:M,disabled:d.value},{default:o(()=>[d.value?(c(),p(_,{key:1},{default:o(()=>[u(C(m))]),_:1})):(c(),p(_,{key:0},{default:o(()=>[u(C(V))]),_:1})),v(" "+r(d.value?"下载中...":"下载资料"),1)]),_:1},8,["disabled"]),u(n,{type:"warning"},{default:o(()=>[...e[3]||(e[3]=[v("下载需要消耗5积分",-1)])]),_:1})])])]),_:1})),[[N,m.value]])])}}},Y=A(P,[["__scopeId","data-v-8819c36b"]]);export{Y as default};
