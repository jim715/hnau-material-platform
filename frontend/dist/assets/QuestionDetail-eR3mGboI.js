import{f as g,o as j,E as l,c as u,a as t,b as a,w as r,H as G,d as A,t as d,F as f,A as B,h as w,B as $,k as W,e as C,u as X,g as c,l as _,T as Y,U as Z,v as ee,O as te,R as N,S as O,Q as M,s as se}from"./index-C2Rltc0A.js";import{a as y}from"./index-CzZzTWyT.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"question-detail"},le={class:"post-container"},ne={class:"post-header"},ie={style:{display:"flex","align-items":"center",gap:"15px"}},re={key:0,class:"options-menu"},ce={class:"post-content"},ue={class:"post-title"},de={class:"post-meta"},me={class:"author"},_e={class:"time"},pe={class:"post-tags"},ve={class:"post-body"},ge={class:"interaction-section"},fe={class:"interaction-stats"},ke={class:"view-count"},he={class:"like-count"},ye={class:"collect-count"},Ie={class:"interaction-buttons"},Se={class:"interaction-btn comment-btn"},we={class:"btn-text"},Ce={key:0,class:"likes-list"},be={class:"likes-text"},xe={class:"comment-section"},qe={class:"comment-input-section"},De={class:"comment-input-container"},Le={class:"comment-submit"},Te={key:0,class:"comment-list"},$e={class:"comment-body"},Ne={class:"comment-header"},Oe={class:"comment-author"},Me={class:"comment-time"},Ae={class:"comment-content"},Be={class:"comment-footer"},Je=["onClick"],Qe={class:"like-count"},Ve={key:1,class:"no-comments"},Ke={__name:"QuestionDetail",setup(ze){const J=W(),Q=X(),p=g(J.params.id),V=()=>{Q.push("/question/list")},v=g({id:"",title:"",content:"",author:"",createTime:"",viewCount:0,likeCount:0,collectCount:0,tags:[]}),q=g(!1),D=g(!1),b=g(!1),k=g([]),I=g({content:""}),x=g(!1),K=async()=>{if(!I.value.content.trim()){l.error("请输入评论内容");return}x.value=!0;try{const o=localStorage.getItem("user");if(!o){l.error("请先登录"),x.value=!1;return}const e=JSON.parse(o);(await y.post("/comment/add",{userId:e.id,relType:1,relId:p.value,content:I.value.content})).code===200?(await T(),I.value.content="",l.success("评论成功，获得3积分")):l.error("评论失败")}catch(o){console.error("评论失败:",o),l.error("评论失败，请检查网络连接")}finally{x.value=!1}},z=async o=>{try{const e=localStorage.getItem("user");if(!e){l.error("请先登录");return}const s=JSON.parse(e),i=await y.post("/comment/like",null,{params:{userId:s.id,commentId:o}});if(i.code===200){const n=`comment_liked_${s.id}_${o}`;i.message==="点赞成功"?localStorage.setItem(n,"true"):i.message==="取消点赞成功"&&localStorage.setItem(n,"false"),await T(),l.success(i.message+"，获得1积分")}else l.error(i.message)}catch(e){console.error("点赞失败:",e),l.error("点赞失败，请检查网络连接")}},L=async()=>{try{const o=await y.get("/question/detail",{params:{id:p.value}});if(o.code===200){const e=o.data,s=e.tags?e.tags.split(",").map(i=>i.trim()):[];v.value={...e,tags:s,createTime:new Date(e.createTime).toLocaleString()},await T(),await E()}else l.error("获取问题详情失败")}catch(o){console.error("获取问题详情失败:",o),l.error("获取问题详情失败")}},E=async()=>{const o=localStorage.getItem("user");if(!o)return;const e=JSON.parse(o);try{const s=String(p.value),i=`question_liked_${e.id}_${s}`,n=`question_collected_${e.id}_${s}`,h=localStorage.getItem(i)==="true",S=localStorage.getItem(n)==="true";q.value=h,D.value=S,console.log("初始化问题状态:",s,"isLiked:",h,"isCollected:",S)}catch(s){console.error("初始化行为状态失败:",s)}},T=async()=>{try{const o=await y.get("/comment/list",{params:{relType:1,relId:p.value}});if(o.code===200){const e=o.data;if(Array.isArray(e)){const s=localStorage.getItem("user"),i=s?JSON.parse(s):null;k.value=e.map(n=>{let h=!1;if(i){const S=`comment_liked_${i.id}_${n.id}`;h=localStorage.getItem(S)==="true"}return{...n,author:n.author||n.name||"未知用户",createTime:n.createTime?new Date(n.createTime).toLocaleString():new Date().toLocaleString(),isLiked:h}})}else k.value=[]}else l.error("获取评论列表失败"),k.value=[]}catch(o){console.error("获取评论列表失败:",o),k.value=[]}},F=async()=>{try{const o=localStorage.getItem("user");if(!o){l.error("请先登录");return}const e=JSON.parse(o),s=await y.post("/question/like",null,{params:{userId:e.id,questionId:p.value}});if(s.code===200){const i=String(p.value),n=`question_liked_${e.id}_${i}`;s.message==="取消点赞成功"?(localStorage.setItem(n,"false"),l.success("取消点赞成功，扣除1积分")):s.message==="点赞成功"&&(localStorage.setItem(n,"true"),l.success("点赞成功，获得1积分")),await L()}else l.error(s.message)}catch(o){console.error("点赞失败:",o),l.error("点赞失败，请检查网络连接")}},R=async()=>{try{const o=localStorage.getItem("user");if(!o){l.error("请先登录");return}const e=JSON.parse(o),s=await y.post("/question/collect",null,{params:{userId:e.id,questionId:p.value}});if(s.code===200){const i=String(p.value),n=`question_collected_${e.id}_${i}`;s.message==="取消收藏成功"?(localStorage.setItem(n,"false"),l.success("取消收藏成功，扣除2积分")):s.message==="收藏成功"&&(localStorage.setItem(n,"true"),l.success("收藏成功，获得2积分")),await L()}else l.error(s.message)}catch(o){console.error("收藏失败:",o),l.error("收藏失败，请检查网络连接")}},U=()=>{b.value=!b.value},P=async()=>{try{console.log("=== 删除问题开始 ==="),console.log("问题ID:",p.value);const o=localStorage.getItem("user");if(console.log("用户信息:",o),!o){l.error("请先登录");return}const e=JSON.parse(o);if(console.log("解析后的用户信息:",e),console.log("用户ID:",e.id),confirm("确定要删除这个问题吗？")){console.log("开始调用删除API");const s=await y.delete("/question/delete",{params:{questionId:p.value,userId:e.id}});console.log("删除API调用结果:",s),s.code===200?(l.success("删除成功"),setTimeout(()=>{window.location.href="/question/list"},1e3)):l.error(s.message||"删除失败")}}catch(o){console.error("删除问题失败:",o),l.error("删除失败，请检查网络连接")}finally{b.value=!1,console.log("=== 删除问题结束 ===")}};return j(()=>{console.log("加载问题ID:",p.value),p.value?L():(console.error("问题ID为空"),l.error("问题ID不存在"))}),(o,e)=>{const s=C("el-icon"),i=C("el-tag"),n=C("el-input"),h=C("el-button"),S=C("el-divider"),H=C("el-empty");return c(),u("div",ae,[t("div",le,[t("div",ne,[t("div",ie,[t("div",{class:"back-btn",onClick:V},[a(s,null,{default:r(()=>[a(_(Y))]),_:1}),e[1]||(e[1]=t("span",null,"返回",-1))]),e[2]||(e[2]=t("div",{class:"logo-section"},[t("div",{class:"logo"},[t("img",{src:"https://trae-api-cn.mchost.guru/api/ide/v1/text_to_image?prompt=school%20logo%20with%20book%20and%20mountain%20symbol&image_size=square",alt:"Logo"})]),t("div",{class:"title"},"学习资料平台")],-1))]),t("div",{class:"more-options",onClick:U},[a(s,null,{default:r(()=>[a(_(Z))]),_:1}),b.value?(c(),u("div",re,[t("div",{class:"option-item",onClick:G(P,["stop"])},"删除问题")])):A("",!0)])]),t("div",ce,[t("h1",ue,d(v.value.title),1),t("div",de,[t("span",me,d(v.value.author),1),t("span",_e,d(v.value.createTime),1)]),t("div",pe,[(c(!0),u(f,null,B(v.value.tags,m=>(c(),ee(i,{key:m,size:"small"},{default:r(()=>[w(d(m),1)]),_:2},1024))),128))]),t("div",ve,d(v.value.content),1)]),t("div",ge,[t("div",fe,[t("span",ke,[a(s,null,{default:r(()=>[a(_(te))]),_:1}),w(" "+d(v.value.viewCount)+" 浏览 ",1)]),t("span",he,[a(s,null,{default:r(()=>[a(_(N))]),_:1}),w(" "+d(Math.max(0,v.value.likeCount||0))+" 点赞 ",1)]),t("span",ye,[a(s,null,{default:r(()=>[a(_(O))]),_:1}),w(" "+d(Math.max(0,v.value.collectCount||0))+" 收藏 ",1)])]),t("div",Ie,[t("div",{class:$(["interaction-btn like-btn",{liked:q.value}]),onClick:F},[q.value?(c(),u(f,{key:0},[a(s,{class:"icon-active"},{default:r(()=>[a(_(M))]),_:1}),e[3]||(e[3]=t("span",{class:"btn-text"},"已赞",-1))],64)):(c(),u(f,{key:1},[a(s,null,{default:r(()=>[a(_(N))]),_:1}),e[4]||(e[4]=t("span",{class:"btn-text"},"点赞",-1))],64))],2),t("div",{class:$(["interaction-btn collect-btn",{collected:D.value}]),onClick:R},[D.value?(c(),u(f,{key:0},[a(s,{class:"icon-active"},{default:r(()=>[a(_(O))]),_:1}),e[5]||(e[5]=t("span",{class:"btn-text"},"已收藏",-1))],64)):(c(),u(f,{key:1},[a(s,null,{default:r(()=>[a(_(O))]),_:1}),e[6]||(e[6]=t("span",{class:"btn-text"},"收藏",-1))],64))],2),t("div",Se,[a(s,null,{default:r(()=>[a(_(se))]),_:1}),t("span",we,d(k.value.length)+" 评论",1)])]),Math.max(0,v.value.likeCount||0)>0?(c(),u("div",Ce,[a(s,null,{default:r(()=>[a(_(M))]),_:1}),t("span",be," 已有 "+d(Math.max(0,v.value.likeCount||0))+" 人点赞 ",1)])):A("",!0)]),t("div",xe,[t("div",qe,[e[8]||(e[8]=t("div",{class:"user-avatar"},[t("img",{src:"https://trae-api-cn.mchost.guru/api/ide/v1/text_to_image?prompt=user%20avatar%20portrait%20simple%20style&image_size=square",alt:"Avatar"})],-1)),t("div",De,[a(n,{modelValue:I.value.content,"onUpdate:modelValue":e[0]||(e[0]=m=>I.value.content=m),type:"textarea",rows:2,placeholder:"说点什么吧...",maxlength:"500","show-word-limit":""},null,8,["modelValue"]),t("div",Le,[a(h,{type:"primary",onClick:K,loading:x.value,disabled:!I.value.content.trim()},{default:r(()=>[...e[7]||(e[7]=[w(" 发布 ",-1)])]),_:1},8,["loading","disabled"])])])]),k.value.length>0?(c(),u("div",Te,[a(S,{"content-position":"left"},{default:r(()=>[...e[9]||(e[9]=[w("全部评论",-1)])]),_:1}),(c(!0),u(f,null,B(k.value,m=>(c(),u("div",{key:m.id,class:"comment-item"},[e[12]||(e[12]=t("div",{class:"comment-avatar"},[t("img",{src:"https://trae-api-cn.mchost.guru/api/ide/v1/text_to_image?prompt=user%20avatar%20portrait%20simple%20style&image_size=square",alt:"Avatar"})],-1)),t("div",$e,[t("div",Ne,[t("span",Oe,d(m.author),1),t("span",Me,d(m.createTime),1)]),t("div",Ae,d(m.content),1),t("div",Be,[t("div",{class:$(["comment-like",{liked:m.isLiked}]),onClick:Ee=>z(m.id)},[m.isLiked?(c(),u(f,{key:0},[a(s,{class:"icon-active"},{default:r(()=>[a(_(M))]),_:1}),e[10]||(e[10]=t("span",{class:"like-text"},"已赞",-1))],64)):(c(),u(f,{key:1},[a(s,null,{default:r(()=>[a(_(N))]),_:1}),e[11]||(e[11]=t("span",{class:"like-text"},"点赞",-1))],64)),t("span",Qe,d(Math.max(0,m.likeCount||0)),1)],10,Je)])])]))),128))])):(c(),u("div",Ve,[a(H,{description:"暂无评论，快来发表第一条评论吧"})]))])])])}}},Pe=oe(Ke,[["__scopeId","data-v-5f081c76"]]);export{Pe as default};
