import{c as x,a as b,b as n,w as v,v as I,d as w,e as _,f as h,g as i,l as A,n as B,h as y}from"./index-C2Rltc0A.js";import{r as N,u as E}from"./xlsx-BUW7exb-.js";import{a as C}from"./index-CzZzTWyT.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"excel-test-container"},O={key:1,class:"parsed-data"},T={__name:"ExcelTest",setup(V){const p=h(null),a=h(""),t=h("info"),f=h([]),k=(u,l)=>{p.value=u.raw,a.value="",f.value=[]},S=async()=>{if(!p.value){a.value="请先选择Excel文件",t.value="warning";return}const u=new FileReader;u.onload=async l=>{try{console.log("开始解析Excel文件");const r=new Uint8Array(l.target.result);console.log("读取文件数据成功，长度:",r.length);const c=N(r,{type:"array"});console.log("解析工作簿成功，工作表数量:",c.SheetNames.length);const g=c.SheetNames[0];console.log("使用工作表:",g);const m=c.Sheets[g];console.log("获取工作表成功");const s=E.sheet_to_json(m);console.log("转换为JSON数据成功，行数:",s.length),console.log("JSON数据:",s);const d=s.map(e=>({studentId:e.studentId||e.学号||"",name:e.name||e.姓名||"",grade:e.grade||e.年级||"",major:e.major||e.专业||"",college:e.college||e.学院||"",className:e.className||e.class||e.班级||""})).filter(e=>e.studentId&&e.name);console.log("转换后的用户数据:",d),f.value=d,a.value=`解析成功，共解析出 ${d.length} 条用户数据`,t.value="success"}catch(r){console.error("解析Excel文件失败:",r),a.value="解析Excel文件失败，请检查文件格式",t.value="error"}},u.onerror=l=>{console.error("文件读取失败:",l),a.value="文件读取失败，请检查文件",t.value="error"},u.readAsArrayBuffer(p.value)},j=async()=>{if(!p.value){a.value="请先选择Excel文件",t.value="warning";return}const u=new FileReader;u.onload=async l=>{try{console.log("开始解析Excel文件");const r=new Uint8Array(l.target.result);console.log("读取文件数据成功，长度:",r.length);const c=N(r,{type:"array"});console.log("解析工作簿成功，工作表数量:",c.SheetNames.length);const g=c.SheetNames[0];console.log("使用工作表:",g);const m=c.Sheets[g];console.log("获取工作表成功");const s=E.sheet_to_json(m);console.log("转换为JSON数据成功，行数:",s.length),console.log("JSON数据:",s);const d=s.map(o=>({studentId:o.studentId||o.学号||"",name:o.name||o.姓名||"",grade:o.grade||o.年级||"",major:o.major||o.专业||"",college:o.college||o.学院||"",className:o.className||o.class||o.班级||""})).filter(o=>o.studentId&&o.name);if(console.log("转换后的用户数据:",d),f.value=d,d.length===0){a.value="Excel文件中没有有效的学生信息",t.value="warning";return}console.log("开始发送批量创建用户请求");const e=await C.post("/api/admin/user/batch",d);console.log("批量创建用户请求成功，响应:",e),e.code===200?(a.value="学生信息上传成功",t.value="success"):(a.value="学生信息上传失败: "+(e.message||"未知错误"),t.value="error")}catch(r){console.error("解析Excel文件失败:",r),a.value="解析Excel文件失败，请检查文件格式",t.value="error"}},u.onerror=l=>{console.error("文件读取失败:",l),a.value="文件读取失败，请检查文件",t.value="error"},u.readAsArrayBuffer(p.value)};return(u,l)=>{const r=_("el-icon"),c=_("el-button"),g=_("el-upload"),m=_("el-alert"),s=_("el-table-column"),d=_("el-table");return i(),x("div",J,[l[4]||(l[4]=b("h1",null,"Excel上传测试",-1)),n(g,{class:"user-upload",action:"","on-change":k,"auto-upload":!1,accept:".xlsx, .xls",multiple:""},{default:v(()=>[n(c,{type:"primary"},{default:v(()=>[n(r,null,{default:v(()=>[n(A(B))]),_:1}),l[0]||(l[0]=y(" 选择Excel文件 ",-1))]),_:1})]),_:1}),n(c,{type:"success",onClick:S,disabled:!p.value},{default:v(()=>[...l[1]||(l[1]=[y(" 测试解析 ",-1)])]),_:1},8,["disabled"]),n(c,{type:"warning",onClick:j,disabled:!p.value},{default:v(()=>[...l[2]||(l[2]=[y(" 上传用户 ",-1)])]),_:1},8,["disabled"]),a.value?(i(),I(m,{key:0,title:a.value,type:t.value,"show-icon":"",class:"mt-4"},null,8,["title","type"])):w("",!0),f.value.length>0?(i(),x("div",O,[l[3]||(l[3]=b("h2",null,"解析结果",-1)),n(d,{data:f.value,style:{width:"100%"}},{default:v(()=>[n(s,{prop:"studentId",label:"学号"}),n(s,{prop:"name",label:"姓名"}),n(s,{prop:"grade",label:"年级"}),n(s,{prop:"major",label:"专业"}),n(s,{prop:"college",label:"学院"})]),_:1},8,["data"])])):w("",!0)])}}},P=F(T,[["__scopeId","data-v-e6a188f4"]]);export{P as default};
