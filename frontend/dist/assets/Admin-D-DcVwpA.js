import{M as ol,c as z,a as d,b as l,w as t,v as W,d as le,G as Se,E as ke,f as g,e as S,y as tl,u as al,g as k,l as M,p as sl,W as nl,X as rl,q as ul,x as il,n as dl,h as m,Y as Ve,t as $,H as cl,Z as ml,_ as gl,$ as pl,B as vl}from"./index-2wzUmdul.js";import{a as w}from"./index-CJj_0Lla.js";import{r as fl,u as Re}from"./xlsx-BUW7exb-.js";import{_ as yl}from"./_plugin-vue_export-helper-DlAUqK2U.js";const _l={class:"admin-container"},bl={class:"admin-menu"},Il={class:"admin-content"},hl={key:0},wl={class:"user-upload-section"},$l={class:"login-records mt-6"},Sl={key:1},kl=["onClick"],Vl={key:1,class:"no-data"},Cl={key:2},Tl={key:3},Dl={key:0,class:"no-data"},Ul={key:4},xl={class:"update-settings"},Rl={class:"update-buttons"},Al={key:5},Ml={class:"dialog-footer"},Nl={class:"dialog-footer"},Pl={class:"material-detail"},Ll={class:"description"},El={class:"file-info"},Fl={class:"dialog-footer"},zl={class:"integral-dialog"},Bl={class:"integral-actions"},ql={class:"dialog-footer"},jl={__name:"Admin",setup(Jl){const Ce=al();console.log("API模块:",w),console.log("API基础URL:",w.defaults.baseURL);const Z=g(""),oe=g(null),n=g(""),u=g("info"),te=g([]),ie=g(!1),Te=g(1),de=g(!1),U=g({}),ye=g([]),ae=g(!1),se=g(!1),N=g({name:"",description:"",parentId:0,sort:0}),P=g({id:"",name:"",description:"",parentId:0,sort:0}),Ae=g({name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}),Me=g({name:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}),_e=g([]),ce=g(!1),X=g(!1),j=g({}),J=g({points:0,reason:""}),Ne=g({points:[{required:!0,message:"请输入积分变动值",trigger:"blur"}],reason:[{required:!0,message:"请输入变动原因",trigger:"blur"}]}),F=g([]),be=g(!1),O=g(0),ne=g(1),Y=g(null),x=g({updateDate:new Date,startTime:new Date,endTime:new Date}),Pe=g({updateDate:[{required:!0,message:"请选择更新日期",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}]}),Ie=g(null),H=g(!1),R=g(""),L=g("info"),B=g(null),Q=g(null),Le=(o,e)=>{console.log("菜单选择:",o),Z.value=o,o==="category-manage"?ge():o==="material-manage"?he():o==="integral-manage"?(console.log("选择了积分管理，准备获取用户列表..."),console.log("localStorage中的token:",localStorage.getItem("token")),console.log("localStorage中的user:",localStorage.getItem("user")),pe()):o==="user-manage"&&el()},Ee=async()=>{try{console.log("Admin页面开始退出登录...");const o=await w.post("/user/logout");console.log("退出登录响应:",o),console.log("强制刷新登录记录...");const e=await w.get("/admin/login/records",{params:{page:ne.value,pageSize:10}});console.log("强制刷新登录记录成功:",e),e.code===200&&e.data&&e.data.list&&(F.value=e.data.list,O.value=e.data.total||0,console.log("Admin页面登录记录已更新")),console.log("等待2秒，让用户看到更新后的退出时间..."),await new Promise(i=>setTimeout(i,2e3)),console.log("等待完成，准备清除token并跳转..."),localStorage.removeItem("user"),localStorage.removeItem("token"),ke.success("退出登录成功"),Ce.push("/login")}catch(o){console.error("退出登录失败:",o),localStorage.removeItem("user"),localStorage.removeItem("token"),ke.success("退出登录成功"),Ce.push("/login")}};window.handleAdminLogout=Ee;const he=async()=>{ie.value=!0;try{const o=await w.get("/admin/material/audit/list");o.code===200?te.value=o.data:(n.value="获取待审核资料失败: "+(o.message||"未知错误"),u.value="error")}catch(o){console.error("获取待审核资料失败:",o),n.value="获取待审核资料失败，请检查网络连接",u.value="error"}finally{ie.value=!1}},De=async(o,e)=>{try{const i=await w.post("/admin/material/audit",{materialId:o,auditStatus:e});i.code===200?(n.value="审核成功",u.value="success",he()):(n.value="审核失败: "+(i.message||"未知错误"),u.value="error")}catch(i){console.error("审核资料失败:",i),n.value="审核资料失败，请检查网络连接",u.value="error"}},Fe=async o=>{try{const e=await w.get(`/material/info/${o.id}`);e.code===200?(U.value=e.data,de.value=!0):(n.value="获取资料详情失败: "+(e.message||"未知错误"),u.value="error")}catch(e){console.error("获取资料详情失败:",e),n.value="获取资料详情失败，请检查网络连接",u.value="error"}},me=o=>o?new Date(o).toLocaleString():"",ze=o=>{if(!o)return"0 B";const e=1024,i=["B","KB","MB","GB","TB"],f=Math.floor(Math.log(o)/Math.log(e));return parseFloat((o/Math.pow(e,f)).toFixed(2))+" "+i[f]},Be=o=>{Te.value=o},ge=async()=>{try{const o=await w.get("/category/list");o.code===200?ye.value=o.data:(n.value="获取分类列表失败",u.value="error")}catch(o){console.error("获取分类列表失败:",o),n.value="获取分类列表失败",u.value="error"}},qe=()=>{N.value={name:"",description:"",parentId:0,sort:0},ae.value=!0},je=o=>{P.value={id:o.id,name:o.name,description:o.description,parentId:o.parentId,sort:o.sort},se.value=!0},Je=async()=>{try{const o=await w.post("/category/create",N.value);o.code===200?(n.value="添加分类成功",u.value="success",ae.value=!1,ge()):(n.value="添加分类失败: "+(o.message||"未知错误"),u.value="error")}catch(o){console.error("添加分类失败:",o),n.value="添加分类失败",u.value="error"}},Oe=async()=>{try{const o=await w.put("/category/update",P.value);o.code===200?(n.value="编辑分类成功",u.value="success",se.value=!1,ge()):(n.value="编辑分类失败: "+(o.message||"未知错误"),u.value="error")}catch(o){console.error("编辑分类失败:",o),n.value="编辑分类失败",u.value="error"}},He=async o=>{try{const e=await w.delete(`/category/delete/${o}`);e.code===200?(n.value="删除分类成功",u.value="success",ge()):(n.value="删除分类失败: "+(e.message||"未知错误"),u.value="error")}catch(e){console.error("删除分类失败:",e),n.value="删除分类失败",u.value="error"}},Ge=(o,e)=>{oe.value=o.raw,n.value=""},Ze=async()=>{if(!oe.value){n.value="请先选择Excel文件",u.value="warning";return}const o=new FileReader;o.onload=async e=>{try{console.log("开始解析Excel文件");const i=new Uint8Array(e.target.result);console.log("读取文件数据成功，长度:",i.length);const f=fl(i,{type:"array"});console.log("解析工作簿成功，工作表数量:",f.SheetNames.length);const E=f.SheetNames[0];console.log("使用工作表:",E);const b=f.Sheets[E];console.log("获取工作表成功");const $e=Re.decode_range(b["!ref"]||"A1:A1");console.log("工作表原始范围:",b["!ref"],"解析后范围:",$e);const re=Re.sheet_to_json(b,{header:1});console.log("原始JSON数据（数组格式）行数:",re.length),console.log("原始JSON数据（数组格式）:",re);const v=re.filter(a=>{if(!a||a.length===0)return!1;const c=a.some(p=>p!=null&&String(p).trim()!=="");return console.log("过滤检查 - 原始数据:",a,"结果:",c),c});console.log("过滤后的数据行数:",v.length),console.log("过滤后的数据:",v);const q=v.map((a,D)=>{let c="",p="",I="",V="",h="",T="";console.log(`=== 开始解析第${D+2}行数据 ===`),console.log("原始数据:",a);const ue=String(a[0]||"").trim();if(["学号","姓名","年级","专业","学院","班级","class","grade","major","college","student_id","studentid"].includes(ue))return console.log("跳过标题行:",a),{studentId:"",name:"",grade:"",major:"",college:"",className:""};for(let y=0;y<a.length;y++){const r=String(a[y]||"").trim();if(console.log(`处理单元格[${y}]: "${r}"`),!c||!p){if(r&&/^\s*\d+\s*[\u4e00-\u9fa5]+\s*$/.test(r)){console.log(`检测到学号和姓名在同一单元格: "${r}"`);const _=r.match(/\d+/),C=r.match(/[\u4e00-\u9fa5]+/);_&&C&&(c=_[0],p=C[0],console.log(`从同一单元格分离 - 学号: "${c}", 姓名: "${p}"`))}else!c&&/^\d+$/.test(r)?(c=r,console.log(`提取学号: ${c}`)):!p&&r&&!/^\d+$/.test(r)&&(p=r,console.log(`提取姓名: ${p}`));if(!c||!p){const _=String(r||"").trim();if(_){const C=_.match(/^(\d+)([\u4e00-\u9fa5]+)$/);C&&C.length===3&&(c=C[1],p=C[2],console.log(`额外处理 - 从"${_}"分离出学号: "${c}", 姓名: "${p}"`))}}}else!I&&r?(I=r,console.log(`提取年级: ${I}`)):!V&&r?(V=r,console.log(`提取专业: ${V}`)):!h&&r?(h=r,console.log(`提取学院: ${h}`)):!T&&r&&(T=r,console.log(`提取班级: ${T}`))}if(c&&p)for(let y=0;y<a.length;y++){const r=String(a[y]||"").trim();r&&!/^\d+[\u4e00-\u9fa5]+$/.test(r)&&!/^\d+$/.test(r)&&!/^[\u4e00-\u9fa5]+$/.test(r)&&(I?V?h?T||(T=r,console.log(`补充提取班级: ${T}`)):(h=r,console.log(`补充提取学院: ${h}`)):(V=r,console.log(`补充提取专业: ${V}`)):(I=r,console.log(`补充提取年级: ${I}`)))}if(!c||!p){console.log(`需要从值中提取数据，当前学号: "${c}", 姓名: "${p}"`);const y=a;console.log(`尝试从值中提取数据，值数量: ${y.length}`,y);const r=[[0,1,2,3,4,5],[1,0,2,3,4,5],[0,1,3,2,4,5],[0,1,2,4,3,5],[0,1,4,2,3,5],[0,1,5,2,3,4]];for(const _ of r)if(y.length>Math.max(..._)){const C=String(y[_[0]]||"").trim(),ee=String(y[_[1]]||"").trim();if(console.log(`尝试顺序 ${_}: 学号="${C}", 姓名="${ee}"`),C&&ee&&/^\d+$/.test(C)){c=C,p=ee,I=String(y[_[2]]||"").trim(),V=String(y[_[3]]||"").trim(),h=String(y[_[4]]||"").trim(),T=String(y[_[5]]||"").trim(),console.log(`从值中提取数据成功，使用顺序: ${_}`,{studentId:c,name:p,grade:I,major:V,college:h,className:T});break}}}if(!c||!p){console.log("尝试特殊处理，直接从原始数据中提取学号和姓名");const y=a;for(let r=0;r<y.length;r++){const _=String(y[r]||"").trim();if(console.log(`处理值[${r}]: "${_}"`),!c||!p)if(_&&/^\s*\d+\s*[\u4e00-\u9fa5]+\s*$/.test(_)){console.log(`检测到学号和姓名在同一单元格: "${_}"`);const C=_.match(/\d+/),ee=_.match(/[\u4e00-\u9fa5]+/);C&&ee&&(c=C[0],p=ee[0],console.log(`从同一单元格分离 - 学号: "${c}", 姓名: "${p}"`))}else!c&&/^\d+$/.test(_)?(c=_,console.log(`特殊处理：提取学号: ${c}`)):!p&&_&&!/^\d+$/.test(_)&&(p=_,console.log(`特殊处理：提取姓名: ${p}`));if(c&&p){r+1<y.length&&(I=String(y[r+1]||"").trim()),r+2<y.length&&(V=String(y[r+2]||"").trim()),r+3<y.length&&(h=String(y[r+3]||"").trim()),r+4<y.length&&(T=String(y[r+4]||"").trim()),console.log("特殊处理成功，提取到完整信息:",{studentId:c,name:p,grade:I,major:V,college:h,className:T});break}}}const G={studentId:c,name:p,grade:I,major:V,college:h,className:T};return console.log(`解析第${D+2}行数据完成:`,{original:a,parsed:G}),console.log(`=== 解析第${D+2}行数据结束 ===`),G}).filter(a=>{const D=a.studentId&&String(a.studentId).trim()!==""&&String(a.studentId).trim()!=="0",c=a.name&&String(a.name).trim()!=="",p=D&&/^\d+$/.test(String(a.studentId).trim()),I=D&&c&&p;return I?console.log("验证通过用户:",a):(console.log("过滤掉无效用户:",a),console.log("验证结果 - 有学号:",D,"有姓名:",c,"学号有效:",p),console.log("学号详细信息:",{value:a.studentId,type:typeof a.studentId,trimmed:a.studentId?String(a.studentId).trim():"",isEmpty:!a.studentId||String(a.studentId).trim()==="",isZero:a.studentId&&String(a.studentId).trim()==="0",isNumber:a.studentId&&/^\d+$/.test(String(a.studentId).trim())}),console.log("姓名详细信息:",{value:a.name,type:typeof a.name,trimmed:a.name?String(a.name).trim():"",isEmpty:!a.name||String(a.name).trim()===""})),I});if(console.log("转换后的用户数据:",q),console.log("最终处理用户数量:",q.length),q.length===0){n.value="Excel文件中没有有效的学生信息",u.value="warning";return}console.log("开始获取已有的用户列表...");let fe=[];try{const a=await w.get("/admin/user/list");console.log("获取已有的用户列表响应:",a),a.code===200&&(fe=a.data)}catch(a){console.error("获取已有的用户列表失败:",a),console.error("错误消息:",a.message),n.value="获取用户列表失败: "+a.message,u.value="error";return}const A=q.filter(a=>{const D=a.studentId&&String(a.studentId).trim()!==""&&/^\d+$/.test(String(a.studentId).trim()),c=a.name&&String(a.name).trim()!=="";return D&&c});console.log("最终发送的有效用户数量:",A.length),console.log("最终发送的用户数据:",A),console.log("开始发送批量创建用户请求"),console.log("用户数量:",A.length),console.log("准备发送的用户数据:",A);let K;if(A.length>0)try{console.log("发送POST请求到 /admin/user/batch"),console.log("确认发送的用户数量:",A.length),K=await w.post("/admin/user/batch",A),console.log("批量创建用户请求响应:",K)}catch(a){console.error("批量创建用户请求失败:",a),console.error("错误消息:",a.message),console.error("错误响应:",a.response),n.value="批量上传失败: "+a.message,u.value="error";return}else K={code:200};if(K.code===200){let a="学生信息上传成功";a+=`，处理了 ${A.length} 个用户`,n.value=a,u.value="success",oe.value=null,setTimeout(()=>{ke.success(`学生信息上传成功！
系统已处理 ${A.length} 个用户
- 新用户将被创建，默认密码为123456
- 已存在的用户信息将被更新为最新信息
- 信息有变动的用户密码将重置为123456
- 信息无变动的用户保持原有密码不变`)},1e3)}else n.value="学生信息上传失败: "+(K.message||"未知错误"),u.value="error"}catch(i){console.error("解析Excel文件失败:",i),console.error("错误堆栈:",i.stack),n.value="解析Excel文件失败，请检查文件格式: "+i.message+`
错误堆栈: `+i.stack,u.value="error"}},o.onerror=e=>{console.error("文件读取失败:",e),console.error("错误堆栈:",e.stack),n.value="文件读取失败，请检查文件: "+e.message,u.value="error"},o.readAsArrayBuffer(oe.value)},pe=async()=>{ce.value=!0;try{console.log("开始获取用户列表..."),console.log("API请求URL:","/admin/user/list"),console.log("API基础URL:",w.defaults.baseURL);const o=w.defaults.baseURL+"/admin/user/list";console.log("完整请求URL:",o),console.log("localStorage中的token:",localStorage.getItem("token")),console.log("localStorage中的user:",localStorage.getItem("user"));const e=await w.get("/admin/user/list");if(console.log("获取用户列表响应:",e),e.code===200){console.log("获取用户列表成功，数据:",e.data),e.data.forEach((f,E)=>{console.log(`用户 ${E+1}: 学号=${f.studentId}, 姓名=${f.name}, className=${f.className}`),console.log(`用户 ${E+1} 所有字段:`,f)});const i=e.data.sort((f,E)=>f.studentId.localeCompare(E.studentId));console.log("排序后的用户列表:",i),i.forEach((f,E)=>{console.log(`排序后用户 ${E+1}: className=${f.className}, 类型=${typeof f.className}`)}),_e.value=i}else console.error("获取用户列表失败:",e.message||"未知错误"),n.value="获取用户列表失败: "+(e.message||"未知错误"),u.value="error"}catch(o){console.error("获取用户列表异常:",o),console.error("异常详情:",o.response),console.error("异常消息:",o.message),n.value="获取用户列表失败，请检查网络连接",u.value="error"}finally{ce.value=!1}},Ke=o=>{j.value=o,J.value={points:0,reason:""},X.value=!0},We=async()=>{try{const o=await w.post("/admin/integral/update",{userId:j.value.id,points:parseInt(J.value.points),reason:J.value.reason});o.code===200?(n.value="积分修改成功",u.value="success",X.value=!1,pe()):(n.value="积分修改失败: "+(o.message||"未知错误"),u.value="error")}catch(o){console.error("修改积分失败:",o),n.value="修改积分失败，请检查网络连接",u.value="error"}},Xe=async()=>{try{const o=await w.post("/admin/integral/clear",{userId:j.value.id});o.code===200?(n.value="积分清除成功",u.value="success",X.value=!1,pe()):(n.value="积分清除失败: "+(o.message||"未知错误"),u.value="error")}catch(o){console.error("清除积分失败:",o),n.value="清除积分失败，请检查网络连接",u.value="error"}},Ye=async()=>{try{console.log("开始测试API...");const o=await w.get("/admin/test");console.log("测试API响应:",o),o.code===200?(n.value="测试API调用成功",u.value="success"):(n.value="测试API调用失败: "+(o.message||"未知错误"),u.value="error")}catch(o){console.error("测试API异常:",o),n.value="测试API调用失败，请检查网络连接",u.value="error"}},ve=async()=>{be.value=!0;try{console.log("开始获取登录记录..."),console.log("请求参数:",{page:ne.value,pageSize:10});const o=localStorage.getItem("token");if(console.log("使用的token:",o),!o){console.error("未登录，token为空"),n.value="获取登录记录失败: 未登录",u.value="error",F.value=[],O.value=0,Ue();return}const e=await w.get("/admin/login/records",{params:{page:ne.value,pageSize:10}});console.log("登录记录响应:",e),console.log("响应类型:",typeof e),e&&e.code===200?e.data?(console.log("响应data:",e.data),e.data.list?(console.log("获取登录记录成功，记录数:",e.data.list.length),F.value=e.data.list,O.value=e.data.total||0,n.value=""):(console.error("响应data中没有list字段"),n.value="获取登录记录失败: 数据结构不正确",u.value="error",F.value=[],O.value=0)):(console.error("响应中没有data字段"),n.value="获取登录记录失败: 数据结构不正确",u.value="error",F.value=[],O.value=0):(console.error("响应code不是200:",e==null?void 0:e.code),n.value="获取登录记录失败: "+((e==null?void 0:e.message)||"未知错误"),u.value="error",F.value=[],O.value=0)}catch(o){console.error("获取登录记录失败:",o),console.error("错误消息:",o.message),console.error("错误堆栈:",o.stack),n.value="获取登录记录失败，请检查网络连接",u.value="error",F.value=[],O.value=0}finally{be.value=!1}},Qe=o=>{ne.value=o,ve()},el=()=>{Y.value&&clearInterval(Y.value),ve(),Y.value=setInterval(()=>{ve()},5e3),console.log("登录记录自动刷新已启动")},Ue=()=>{Y.value&&(clearInterval(Y.value),Y.value=null,console.log("登录记录自动刷新已停止"))},ll=async()=>{Ie.value&&await Ie.value.validate(async o=>{if(o)try{const e=new Date(x.value.startTime),i=new Date,f=e.getTime()-i.getTime();console.log("开始时间:",e),console.log("当前时间:",i),console.log("开始时间差(毫秒):",f),f>0?(R.value=`系统将在 ${e.toLocaleString()} 开始更新`,L.value="info",Q.value&&clearTimeout(Q.value),Q.value=setTimeout(async()=>{console.log("到达开始时间，自动执行开始更新..."),await xe()},f),console.log("开始更新定时器已设置，将在",e,"自动执行")):await xe()}catch(e){console.error("系统更新开始失败:",e),R.value="系统更新开始失败，请检查网络连接",L.value="error",H.value=!1}})},xe=async()=>{try{H.value=!0,R.value="系统开始更新，正在强制所有用户退出...",L.value="warning",console.log("开始强制所有用户退出...");const o=await w.post("/admin/system/update/start",{updateDate:x.value.updateDate,startTime:x.value.startTime,endTime:x.value.endTime});if(o.code===200){R.value="系统更新开始成功，所有用户已被强制退出",L.value="success",console.log("系统更新开始成功，管理员可以继续操作"),console.log("设置更新完成定时器...");const e=new Date(x.value.endTime),i=new Date,f=e.getTime()-i.getTime();f>0?(console.log("结束时间:",e),console.log("当前时间:",i),console.log("结束时间差(毫秒):",f),B.value&&clearTimeout(B.value),B.value=setTimeout(async()=>{console.log("到达结束时间，自动调用更新完成方法..."),await we()},f),console.log("更新完成定时器已设置，将在",e,"自动执行")):(console.log("结束时间已过，立即调用更新完成方法..."),await we())}else R.value="系统更新开始失败: "+(o.message||"未知错误"),L.value="error",H.value=!1}catch(o){console.error("系统更新执行失败:",o),R.value="系统更新执行失败，请检查网络连接",L.value="error",H.value=!1}},we=async()=>{try{R.value="正在完成系统更新...",L.value="info",B.value&&(clearTimeout(B.value),B.value=null,console.log("更新完成定时器已清除")),console.log("完成系统更新...");const o=await w.post("/admin/system/update/complete");o.code===200?(R.value="系统更新完成，所有功能已恢复正常",L.value="success",H.value=!1):(R.value="系统更新完成失败: "+(o.message||"未知错误"),L.value="error")}catch(o){console.error("系统更新完成失败:",o),R.value="系统更新完成失败，请检查网络连接",L.value="error"}};return ol(()=>{Ue(),B.value&&(clearTimeout(B.value),B.value=null,console.log("更新完成定时器已清除")),Q.value&&(clearTimeout(Q.value),Q.value=null,console.log("开始更新定时器已清除")),console.log("Admin组件已卸载，定时器已清理")}),(o,e)=>{const i=S("el-icon"),f=S("el-menu-item"),E=S("el-menu"),b=S("el-button"),$e=S("el-upload"),re=S("el-alert"),v=S("el-table-column"),q=S("el-table"),fe=S("el-pagination"),A=S("el-empty"),K=S("el-date-picker"),a=S("el-form-item"),D=S("el-time-picker"),c=S("el-form"),p=S("el-card"),I=S("el-input"),V=S("el-dialog"),h=S("el-descriptions-item"),T=S("el-descriptions"),ue=tl("loading");return k(),z("div",_l,[d("div",bl,[l(E,{"default-active":Z.value,class:"el-menu-vertical-demo",onSelect:Le},{default:t(()=>[l(f,{index:"user-manage"},{default:t(()=>[l(i,null,{default:t(()=>[l(M(sl))]),_:1}),e[21]||(e[21]=d("span",null,"用户管理",-1))]),_:1}),l(f,{index:"material-manage"},{default:t(()=>[l(i,null,{default:t(()=>[l(M(nl))]),_:1}),e[22]||(e[22]=d("span",null,"资料管理",-1))]),_:1}),l(f,{index:"category-manage"},{default:t(()=>[l(i,null,{default:t(()=>[l(M(rl))]),_:1}),e[23]||(e[23]=d("span",null,"分类管理",-1))]),_:1}),l(f,{index:"integral-manage"},{default:t(()=>[l(i,null,{default:t(()=>[l(M(ul))]),_:1}),e[24]||(e[24]=d("span",null,"积分管理",-1))]),_:1}),l(f,{index:"system-setting"},{default:t(()=>[l(i,null,{default:t(()=>[l(M(il))]),_:1}),e[25]||(e[25]=d("span",null,"系统设置",-1))]),_:1})]),_:1},8,["default-active"])]),d("div",Il,[Z.value==="user-manage"?(k(),z("div",hl,[e[31]||(e[31]=d("h2",null,"用户管理",-1)),d("div",wl,[l($e,{class:"user-upload",action:"","on-change":Ge,"auto-upload":!1,accept:".xlsx, .xls",multiple:""},{tip:t(()=>[...e[27]||(e[27]=[d("div",{class:"el-upload__tip"}," 请上传包含学生信息的Excel文件，支持.xlsx和.xls格式 ",-1)])]),default:t(()=>[l(b,{type:"primary"},{default:t(()=>[l(i,null,{default:t(()=>[l(M(dl))]),_:1}),e[26]||(e[26]=m(" 上传学生信息Excel文件 ",-1))]),_:1})]),_:1}),l(b,{type:"success",onClick:Ze,disabled:!oe.value,class:"ml-4"},{default:t(()=>[...e[28]||(e[28]=[m(" 确认上传 ",-1)])]),_:1},8,["disabled"])]),n.value?(k(),W(re,{key:0,title:n.value,type:u.value,"show-icon":"",class:"mt-4"},null,8,["title","type"])):le("",!0),d("div",$l,[e[30]||(e[30]=d("h3",null,"登录记录",-1)),l(b,{type:"primary",onClick:ve,class:"mb-4"},{default:t(()=>[l(i,null,{default:t(()=>[l(M(Ve))]),_:1}),e[29]||(e[29]=m(" 刷新登录记录 ",-1))]),_:1}),Se((k(),W(q,{data:F.value,style:{width:"100%"}},{default:t(()=>[l(v,{prop:"id",label:"ID",width:"80"}),l(v,{prop:"username",label:"用户名",width:"120"}),l(v,{prop:"studentId",label:"学号",width:"150"}),l(v,{prop:"loginTime",label:"登录时间",width:"180"},{default:t(s=>[m($(me(s.row.loginTime)),1)]),_:1}),l(v,{prop:"device",label:"登录设备","min-width":"200"}),l(v,{prop:"ipAddress",label:"IP地址",width:"150"}),l(v,{prop:"logoutTime",label:"退出时间",width:"180"},{default:t(s=>[m($(s.row.logoutTime?me(s.row.logoutTime):"-"),1)]),_:1}),l(v,{prop:"status",label:"状态",width:"100"},{default:t(s=>[m($(s.row.status===0?"在线":"已退出"),1)]),_:1})]),_:1},8,["data"])),[[ue,be.value]]),F.value&&F.value.length>0?(k(),W(fe,{key:0,layout:"prev, pager, next",total:O.value,"page-size":10,"current-page":ne.value,onCurrentChange:Qe,class:"mt-4"},null,8,["total","current-page"])):le("",!0)])])):Z.value==="material-manage"?(k(),z("div",Sl,[e[35]||(e[35]=d("h2",null,"资料管理",-1)),l(b,{type:"primary",onClick:he},{default:t(()=>[l(i,null,{default:t(()=>[l(M(Ve))]),_:1}),e[32]||(e[32]=m(" 刷新待审核列表 ",-1))]),_:1}),Se((k(),W(q,{data:te.value,style:{width:"100%"}},{default:t(()=>[l(v,{prop:"id",label:"ID",width:"80"}),l(v,{prop:"name",label:"资料名称","min-width":"200"},{default:t(s=>[d("a",{href:"#",onClick:cl(G=>Fe(s.row),["prevent"])},$(s.row.name),9,kl)]),_:1}),l(v,{prop:"categoryId",label:"分类ID",width:"100"}),l(v,{prop:"userId",label:"上传用户ID",width:"120"}),l(v,{prop:"createTime",label:"上传时间",width:"180"},{default:t(s=>[m($(me(s.row.createTime)),1)]),_:1}),l(v,{label:"操作",width:"180"},{default:t(s=>[l(b,{type:"success",size:"small",onClick:G=>De(s.row.id,1)},{default:t(()=>[...e[33]||(e[33]=[m(" 通过 ",-1)])]),_:1},8,["onClick"]),l(b,{type:"danger",size:"small",onClick:G=>De(s.row.id,2)},{default:t(()=>[...e[34]||(e[34]=[m(" 驳回 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,ie.value]]),te.value.length>0?(k(),W(fe,{key:0,layout:"prev, pager, next",total:te.value.length,"page-size":10,"current-page":Te.value,onCurrentChange:Be,class:"mt-4"},null,8,["total","current-page"])):le("",!0),te.value.length===0&&!ie.value?(k(),z("div",Vl,[l(A,{description:"暂无待审核资料"})])):le("",!0)])):Z.value==="category-manage"?(k(),z("div",Cl,[e[39]||(e[39]=d("h2",null,"分类管理",-1)),l(b,{type:"primary",onClick:qe},{default:t(()=>[l(i,null,{default:t(()=>[l(M(ml))]),_:1}),e[36]||(e[36]=m(" 添加分类 ",-1))]),_:1}),(k(),W(q,{data:ye.value,style:{width:"100%"},key:ye.value.length},{default:t(()=>[l(v,{prop:"id",label:"分类ID",width:"80"}),l(v,{prop:"name",label:"分类名称"}),l(v,{prop:"description",label:"分类描述"}),l(v,{prop:"parentId",label:"父分类ID",width:"120"}),l(v,{prop:"sort",label:"排序",width:"80"}),l(v,{label:"操作",width:"150"},{default:t(s=>[l(b,{type:"primary",size:"small",onClick:G=>je(s.row)},{default:t(()=>[l(i,null,{default:t(()=>[l(M(gl))]),_:1}),e[37]||(e[37]=m(" 编辑 ",-1))]),_:1},8,["onClick"]),l(b,{type:"danger",size:"small",onClick:G=>He(s.row.id)},{default:t(()=>[l(i,null,{default:t(()=>[l(M(pl))]),_:1}),e[38]||(e[38]=m(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]))])):Z.value==="integral-manage"?(k(),z("div",Tl,[e[43]||(e[43]=d("h2",null,"积分管理",-1)),l(b,{type:"primary",onClick:pe},{default:t(()=>[l(i,null,{default:t(()=>[l(M(Ve))]),_:1}),e[40]||(e[40]=m(" 刷新用户列表 ",-1))]),_:1}),l(b,{type:"success",onClick:Ye},{default:t(()=>[...e[41]||(e[41]=[m(" 测试API ",-1)])]),_:1}),Se((k(),W(q,{data:_e.value,style:{width:"100%"}},{default:t(()=>[l(v,{prop:"id",label:"用户ID",width:"100"}),l(v,{prop:"studentId",label:"学号",width:"150"}),l(v,{prop:"name",label:"姓名",width:"120"}),l(v,{prop:"college",label:"学院"}),l(v,{prop:"major",label:"专业"}),l(v,{label:"班级",width:"120"},{default:t(s=>[m($(s.row.className||"未设置"),1)]),_:1}),l(v,{prop:"points",label:"当前积分",width:"120"}),l(v,{label:"操作",width:"180"},{default:t(s=>[l(b,{type:"primary",size:"small",onClick:G=>Ke(s.row)},{default:t(()=>[...e[42]||(e[42]=[m(" 操作积分 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ue,ce.value]]),_e.value.length===0&&!ce.value?(k(),z("div",Dl,[l(A,{description:"暂无用户数据"})])):le("",!0)])):Z.value==="system-setting"?(k(),z("div",Ul,[e[46]||(e[46]=d("h2",null,"系统设置",-1)),l(p,{class:"system-update-card"},{header:t(()=>[...e[44]||(e[44]=[d("div",{class:"card-header"},[d("span",null,"系统更新设置")],-1)])]),default:t(()=>[d("div",xl,[l(c,{model:x.value,rules:Pe.value,ref_key:"updateFormRef",ref:Ie},{default:t(()=>[l(a,{label:"更新日期",prop:"updateDate"},{default:t(()=>[l(K,{modelValue:x.value.updateDate,"onUpdate:modelValue":e[0]||(e[0]=s=>x.value.updateDate=s),type:"date",placeholder:"选择更新日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(a,{label:"开始时间",prop:"startTime"},{default:t(()=>[l(D,{modelValue:x.value.startTime,"onUpdate:modelValue":e[1]||(e[1]=s=>x.value.startTime=s),placeholder:"选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(a,{label:"结束时间",prop:"endTime"},{default:t(()=>[l(D,{modelValue:x.value.endTime,"onUpdate:modelValue":e[2]||(e[2]=s=>x.value.endTime=s),placeholder:"选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),d("div",Rl,[l(b,{type:"danger",onClick:ll,disabled:H.value},{default:t(()=>[m($(H.value?"更新中...":"开始更新"),1)]),_:1},8,["disabled"]),l(b,{type:"success",onClick:we,disabled:!H.value},{default:t(()=>[...e[45]||(e[45]=[m(" 更新完成 ",-1)])]),_:1},8,["disabled"])]),R.value?(k(),z("div",{key:0,class:vl(["update-message",L.value])},$(R.value),3)):le("",!0)])]),_:1})])):(k(),z("div",Al,[...e[47]||(e[47]=[d("h2",null,"欢迎",-1),d("p",null,"请选择左侧菜单进行操作",-1)])])),l(V,{modelValue:ae.value,"onUpdate:modelValue":e[8]||(e[8]=s=>ae.value=s),title:"添加分类",width:"500px"},{footer:t(()=>[d("span",Ml,[l(b,{onClick:e[7]||(e[7]=s=>ae.value=!1)},{default:t(()=>[...e[48]||(e[48]=[m("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:Je},{default:t(()=>[...e[49]||(e[49]=[m("确定",-1)])]),_:1})])]),default:t(()=>[l(c,{model:N.value,rules:Ae.value,ref:"addCategoryFormRef"},{default:t(()=>[l(a,{label:"分类名称",prop:"name"},{default:t(()=>[l(I,{modelValue:N.value.name,"onUpdate:modelValue":e[3]||(e[3]=s=>N.value.name=s),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),l(a,{label:"分类描述",prop:"description"},{default:t(()=>[l(I,{modelValue:N.value.description,"onUpdate:modelValue":e[4]||(e[4]=s=>N.value.description=s),placeholder:"请输入分类描述",type:"textarea"},null,8,["modelValue"])]),_:1}),l(a,{label:"父分类ID",prop:"parentId"},{default:t(()=>[l(I,{modelValue:N.value.parentId,"onUpdate:modelValue":e[5]||(e[5]=s=>N.value.parentId=s),placeholder:"请输入父分类ID，根分类为0",type:"number"},null,8,["modelValue"])]),_:1}),l(a,{label:"排序",prop:"sort"},{default:t(()=>[l(I,{modelValue:N.value.sort,"onUpdate:modelValue":e[6]||(e[6]=s=>N.value.sort=s),placeholder:"请输入排序",type:"number"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(V,{modelValue:se.value,"onUpdate:modelValue":e[14]||(e[14]=s=>se.value=s),title:"编辑分类",width:"500px"},{footer:t(()=>[d("span",Nl,[l(b,{onClick:e[13]||(e[13]=s=>se.value=!1)},{default:t(()=>[...e[50]||(e[50]=[m("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:Oe},{default:t(()=>[...e[51]||(e[51]=[m("确定",-1)])]),_:1})])]),default:t(()=>[l(c,{model:P.value,rules:Me.value,ref:"editCategoryFormRef"},{default:t(()=>[l(a,{label:"分类名称",prop:"name"},{default:t(()=>[l(I,{modelValue:P.value.name,"onUpdate:modelValue":e[9]||(e[9]=s=>P.value.name=s),placeholder:"请输入分类名称"},null,8,["modelValue"])]),_:1}),l(a,{label:"分类描述",prop:"description"},{default:t(()=>[l(I,{modelValue:P.value.description,"onUpdate:modelValue":e[10]||(e[10]=s=>P.value.description=s),placeholder:"请输入分类描述",type:"textarea"},null,8,["modelValue"])]),_:1}),l(a,{label:"父分类ID",prop:"parentId"},{default:t(()=>[l(I,{modelValue:P.value.parentId,"onUpdate:modelValue":e[11]||(e[11]=s=>P.value.parentId=s),placeholder:"请输入父分类ID，根分类为0",type:"number"},null,8,["modelValue"])]),_:1}),l(a,{label:"排序",prop:"sort"},{default:t(()=>[l(I,{modelValue:P.value.sort,"onUpdate:modelValue":e[12]||(e[12]=s=>P.value.sort=s),placeholder:"请输入排序",type:"number"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(V,{modelValue:de.value,"onUpdate:modelValue":e[16]||(e[16]=s=>de.value=s),title:U.value.name||"资料详情",width:"80%"},{footer:t(()=>[d("span",Fl,[l(b,{onClick:e[15]||(e[15]=s=>de.value=!1)},{default:t(()=>[...e[54]||(e[54]=[m("关闭",-1)])]),_:1})])]),default:t(()=>[d("div",Pl,[l(T,{column:2,border:""},{default:t(()=>[l(h,{label:"资料ID"},{default:t(()=>[m($(U.value.id),1)]),_:1}),l(h,{label:"上传用户ID"},{default:t(()=>[m($(U.value.userId),1)]),_:1}),l(h,{label:"分类ID"},{default:t(()=>[m($(U.value.categoryId),1)]),_:1}),l(h,{label:"上传时间"},{default:t(()=>[m($(me(U.value.createTime)),1)]),_:1}),l(h,{label:"文件大小"},{default:t(()=>[m($(ze(U.value.fileSize)),1)]),_:1}),l(h,{label:"审核状态"},{default:t(()=>[m($(U.value.auditStatus===0?"待审核":U.value.auditStatus===1?"已通过":"已驳回"),1)]),_:1})]),_:1}),d("div",Ll,[e[52]||(e[52]=d("h3",null,"资料描述",-1)),d("p",null,$(U.value.description||"无描述"),1)]),d("div",El,[e[53]||(e[53]=d("h3",null,"文件信息",-1)),d("p",null,"文件路径: "+$(U.value.filePath),1),d("p",null,"文件名: "+$(U.value.fileName),1)])])]),_:1},8,["modelValue","title"]),l(V,{modelValue:X.value,"onUpdate:modelValue":e[20]||(e[20]=s=>X.value=s),title:`积分操作 - ${j.value.name||""}`,width:"500px"},{footer:t(()=>[d("span",ql,[l(b,{onClick:e[19]||(e[19]=s=>X.value=!1)},{default:t(()=>[...e[56]||(e[56]=[m("取消",-1)])]),_:1}),l(b,{type:"primary",onClick:We},{default:t(()=>[...e[57]||(e[57]=[m("改变积分",-1)])]),_:1}),l(b,{type:"danger",onClick:Xe},{default:t(()=>[...e[58]||(e[58]=[m("清除积分",-1)])]),_:1})])]),default:t(()=>[d("div",zl,[l(T,{column:2,border:""},{default:t(()=>[l(h,{label:"用户ID"},{default:t(()=>[m($(j.value.id),1)]),_:1}),l(h,{label:"学号"},{default:t(()=>[m($(j.value.studentId),1)]),_:1}),l(h,{label:"姓名"},{default:t(()=>[m($(j.value.name),1)]),_:1}),l(h,{label:"当前积分"},{default:t(()=>[m($(j.value.points||0),1)]),_:1})]),_:1}),d("div",Bl,[e[55]||(e[55]=d("h3",null,"操作选项",-1)),l(c,{model:J.value,rules:Ne.value,ref:"integralFormRef"},{default:t(()=>[l(a,{label:"改变积分",prop:"points"},{default:t(()=>[l(I,{modelValue:J.value.points,"onUpdate:modelValue":e[17]||(e[17]=s=>J.value.points=s),placeholder:"请输入积分变动值（正数增加，负数减少）",type:"number"},null,8,["modelValue"])]),_:1}),l(a,{label:"变动原因",prop:"reason"},{default:t(()=>[l(I,{modelValue:J.value.reason,"onUpdate:modelValue":e[18]||(e[18]=s=>J.value.reason=s),placeholder:"请输入积分变动原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])])]),_:1},8,["modelValue","title"])])])}}},Kl=yl(jl,[["__scopeId","data-v-452ee398"]]);export{Kl as default};
